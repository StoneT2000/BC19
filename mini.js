'use strict';

var SPECS = {"COMMUNICATION_BITS":16,"CASTLE_TALK_BITS":8,"MAX_ROUNDS":1000,"TRICKLE_FUEL":25,"INITIAL_KARBONITE":100,"INITIAL_FUEL":500,"MINE_FUEL_COST":1,"KARBONITE_YIELD":2,"FUEL_YIELD":10,"MAX_TRADE":1024,"MAX_BOARD_SIZE":64,"MAX_ID":4096,"CASTLE":0,"CHURCH":1,"PILGRIM":2,"CRUSADER":3,"PROPHET":4,"PREACHER":5,"RED":0,"BLUE":1,"CHESS_INITIAL":100,"CHESS_EXTRA":20,"TURN_MAX_TIME":200,"MAX_MEMORY":50000000,"UNITS":[{"CONSTRUCTION_KARBONITE":null,"CONSTRUCTION_FUEL":null,"KARBONITE_CAPACITY":null,"FUEL_CAPACITY":null,"SPEED":0,"FUEL_PER_MOVE":null,"STARTING_HP":200,"VISION_RADIUS":100,"ATTACK_DAMAGE":10,"ATTACK_RADIUS":[1,64],"ATTACK_FUEL_COST":10,"DAMAGE_SPREAD":0},{"CONSTRUCTION_KARBONITE":50,"CONSTRUCTION_FUEL":200,"KARBONITE_CAPACITY":null,"FUEL_CAPACITY":null,"SPEED":0,"FUEL_PER_MOVE":null,"STARTING_HP":100,"VISION_RADIUS":100,"ATTACK_DAMAGE":0,"ATTACK_RADIUS":0,"ATTACK_FUEL_COST":0,"DAMAGE_SPREAD":0},{"CONSTRUCTION_KARBONITE":10,"CONSTRUCTION_FUEL":50,"KARBONITE_CAPACITY":20,"FUEL_CAPACITY":100,"SPEED":4,"FUEL_PER_MOVE":1,"STARTING_HP":10,"VISION_RADIUS":100,"ATTACK_DAMAGE":null,"ATTACK_RADIUS":null,"ATTACK_FUEL_COST":null,"DAMAGE_SPREAD":null},{"CONSTRUCTION_KARBONITE":15,"CONSTRUCTION_FUEL":50,"KARBONITE_CAPACITY":20,"FUEL_CAPACITY":100,"SPEED":9,"FUEL_PER_MOVE":1,"STARTING_HP":40,"VISION_RADIUS":49,"ATTACK_DAMAGE":10,"ATTACK_RADIUS":[1,16],"ATTACK_FUEL_COST":10,"DAMAGE_SPREAD":0},{"CONSTRUCTION_KARBONITE":25,"CONSTRUCTION_FUEL":50,"KARBONITE_CAPACITY":20,"FUEL_CAPACITY":100,"SPEED":4,"FUEL_PER_MOVE":2,"STARTING_HP":20,"VISION_RADIUS":64,"ATTACK_DAMAGE":10,"ATTACK_RADIUS":[16,64],"ATTACK_FUEL_COST":25,"DAMAGE_SPREAD":0},{"CONSTRUCTION_KARBONITE":30,"CONSTRUCTION_FUEL":50,"KARBONITE_CAPACITY":20,"FUEL_CAPACITY":100,"SPEED":4,"FUEL_PER_MOVE":3,"STARTING_HP":60,"VISION_RADIUS":16,"ATTACK_DAMAGE":20,"ATTACK_RADIUS":[1,16],"ATTACK_FUEL_COST":15,"DAMAGE_SPREAD":3}]};

function insulate(content) {
    return JSON.parse(JSON.stringify(content));
}

class BCAbstractRobot {
    constructor() {
        this._bc_reset_state();
    }

    // Hook called by runtime, sets state and calls turn.
    _do_turn(game_state) {
        this._bc_game_state = game_state;
        this.id = game_state.id;
        this.karbonite = game_state.karbonite;
        this.fuel = game_state.fuel;
        this.last_offer = game_state.last_offer;

        this.me = this.getRobot(this.id);

        if (this.me.turn === 1) {
            this.map = game_state.map;
            this.karbonite_map = game_state.karbonite_map;
            this.fuel_map = game_state.fuel_map;
        }

        try {
            var t = this.turn();
        } catch (e) {
            t = this._bc_error_action(e);
        }

        if (!t) t = this._bc_null_action();

        t.signal = this._bc_signal;
        t.signal_radius = this._bc_signal_radius;
        t.logs = this._bc_logs;
        t.castle_talk = this._bc_castle_talk;

        this._bc_reset_state();

        return t;
    }

    _bc_reset_state() {
        // Internal robot state representation
        this._bc_logs = [];
        this._bc_signal = 0;
        this._bc_signal_radius = 0;
        this._bc_game_state = null;
        this._bc_castle_talk = 0;
        this.me = null;
        this.id = null;
        this.fuel = null;
        this.karbonite = null;
        this.last_offer = null;
    }

    // Action template
    _bc_null_action() {
        return {
            'signal': this._bc_signal,
            'signal_radius': this._bc_signal_radius,
            'logs': this._bc_logs,
            'castle_talk': this._bc_castle_talk
        };
    }

    _bc_error_action(e) {
        var a = this._bc_null_action();
        
        if (e.stack) a.error = e.stack;
        else a.error = e.toString();

        return a;
    }

    _bc_action(action, properties) {
        var a = this._bc_null_action();
        if (properties) for (var key in properties) { a[key] = properties[key]; }
        a['action'] = action;
        return a;
    }

    _bc_check_on_map(x, y) {
        return x >= 0 && x < this._bc_game_state.shadow[0].length && y >= 0 && y < this._bc_game_state.shadow.length;
    }
    
    log(message) {
        this._bc_logs.push(JSON.stringify(message));
    }

    // Set signal value.
    signal(value, radius) {
        // Check if enough fuel to signal, and that valid value.
        
        var fuelNeeded = Math.ceil(Math.sqrt(radius));
        if (this.fuel < fuelNeeded) throw "Not enough fuel to signal given radius.";
        if (!Number.isInteger(value) || value < 0 || value >= Math.pow(2,SPECS.COMMUNICATION_BITS)) throw "Invalid signal, must be int within bit range.";
        if (radius > 2*Math.pow(SPECS.MAX_BOARD_SIZE-1,2)) throw "Signal radius is too big.";

        this._bc_signal = value;
        this._bc_signal_radius = radius;

        this.fuel -= fuelNeeded;
    }

    // Set castle talk value.
    castleTalk(value) {
        // Check if enough fuel to signal, and that valid value.

        if (!Number.isInteger(value) || value < 0 || value >= Math.pow(2,SPECS.CASTLE_TALK_BITS)) throw "Invalid castle talk, must be between 0 and 2^8.";

        this._bc_castle_talk = value;
    }

    proposeTrade(karbonite, fuel) {
        if (this.me.unit !== SPECS.CASTLE) throw "Only castles can trade.";
        if (!Number.isInteger(karbonite) || !Number.isInteger(fuel)) throw "Must propose integer valued trade."
        if (Math.abs(karbonite) >= SPECS.MAX_TRADE || Math.abs(fuel) >= SPECS.MAX_TRADE) throw "Cannot trade over " + SPECS.MAX_TRADE + " in a given turn.";

        return this._bc_action('trade', {
            trade_fuel: fuel,
            trade_karbonite: karbonite
        });
    }

    buildUnit(unit, dx, dy) {
        if (this.me.unit !== SPECS.PILGRIM && this.me.unit !== SPECS.CASTLE && this.me.unit !== SPECS.CHURCH) throw "This unit type cannot build.";
        if (this.me.unit === SPECS.PILGRIM && unit !== SPECS.CHURCH) throw "Pilgrims can only build churches.";
        if (this.me.unit !== SPECS.PILGRIM && unit === SPECS.CHURCH) throw "Only pilgrims can build churches.";
        
        if (!Number.isInteger(dx) || !Number.isInteger(dx) || dx < -1 || dy < -1 || dx > 1 || dy > 1) throw "Can only build in adjacent squares.";
        if (!this._bc_check_on_map(this.me.x+dx,this.me.y+dy)) throw "Can't build units off of map.";
        if (this._bc_game_state.shadow[this.me.y+dy][this.me.x+dx] > 0) throw "Cannot build on occupied tile.";
        if (!this.map[this.me.y+dy][this.me.x+dx]) throw "Cannot build onto impassable terrain.";
        if (this.karbonite < SPECS.UNITS[unit].CONSTRUCTION_KARBONITE || this.fuel < SPECS.UNITS[unit].CONSTRUCTION_FUEL) throw "Cannot afford to build specified unit.";

        return this._bc_action('build', {
            dx: dx, dy: dy,
            build_unit: unit
        });
    }

    move(dx, dy) {
        if (this.me.unit === SPECS.CASTLE || this.me.unit === SPECS.CHURCH) throw "Churches and Castles cannot move.";
        if (!this._bc_check_on_map(this.me.x+dx,this.me.y+dy)) throw "Can't move off of map.";
        if (this._bc_game_state.shadow[this.me.y+dy][this.me.x+dx] === -1) throw "Cannot move outside of vision range.";
        if (this._bc_game_state.shadow[this.me.y+dy][this.me.x+dx] !== 0) throw "Cannot move onto occupied tile.";
        if (!this.map[this.me.y+dy][this.me.x+dx]) throw "Cannot move onto impassable terrain.";

        var r = Math.pow(dx,2) + Math.pow(dy,2);  // Squared radius
        if (r > SPECS.UNITS[this.me.unit]['SPEED']) throw "Slow down, cowboy.  Tried to move faster than unit can.";
        if (this.fuel < r*SPECS.UNITS[this.me.unit]['FUEL_PER_MOVE']) throw "Not enough fuel to move at given speed.";

        return this._bc_action('move', {
            dx: dx, dy: dy
        });
    }

    mine() {
        if (this.me.unit !== SPECS.PILGRIM) throw "Only Pilgrims can mine.";
        if (this.fuel < SPECS.MINE_FUEL_COST) throw "Not enough fuel to mine.";
        
        if (this.karbonite_map[this.me.y][this.me.x]) {
            if (this.me.karbonite >= SPECS.UNITS[SPECS.PILGRIM].KARBONITE_CAPACITY) throw "Cannot mine, as at karbonite capacity.";
        } else if (this.fuel_map[this.me.y][this.me.x]) {
            if (this.me.fuel >= SPECS.UNITS[SPECS.PILGRIM].FUEL_CAPACITY) throw "Cannot mine, as at fuel capacity.";
        } else throw "Cannot mine square without fuel or karbonite.";

        return this._bc_action('mine');
    }

    give(dx, dy, karbonite, fuel) {
        if (dx > 1 || dx < -1 || dy > 1 || dy < -1 || (dx === 0 && dy === 0)) throw "Can only give to adjacent squares.";
        if (!this._bc_check_on_map(this.me.x+dx,this.me.y+dy)) throw "Can't give off of map.";
        if (this._bc_game_state.shadow[this.me.y+dy][this.me.x+dx] <= 0) throw "Cannot give to empty square.";
        if (karbonite < 0 || fuel < 0 || this.me.karbonite < karbonite || this.me.fuel < fuel) throw "Do not have specified amount to give.";

        return this._bc_action('give', {
            dx:dx, dy:dy,
            give_karbonite:karbonite,
            give_fuel:fuel
        });
    }

    attack(dx, dy) {
        if (this.me.unit === SPECS.CHURCH) throw "Churches cannot attack.";
        if (this.fuel < SPECS.UNITS[this.me.unit].ATTACK_FUEL_COST) throw "Not enough fuel to attack.";
        if (!this._bc_check_on_map(this.me.x+dx,this.me.y+dy)) throw "Can't attack off of map.";
        if (this._bc_game_state.shadow[this.me.y+dy][this.me.x+dx] === -1) throw "Cannot attack outside of vision range.";

        var r = Math.pow(dx,2) + Math.pow(dy,2);
        if (r > SPECS.UNITS[this.me.unit]['ATTACK_RADIUS'][1] || r < SPECS.UNITS[this.me.unit]['ATTACK_RADIUS'][0]) throw "Cannot attack outside of attack range.";

        return this._bc_action('attack', {
            dx:dx, dy:dy
        });
        
    }


    // Get robot of a given ID
    getRobot(id) {
        if (id <= 0) return null;
        for (var i=0; i<this._bc_game_state.visible.length; i++) {
            if (this._bc_game_state.visible[i].id === id) {
                return insulate(this._bc_game_state.visible[i]);
            }
        } return null;
    }

    // Check if a given robot is visible.
    isVisible(robot) {
        return ('unit' in robot);
    }

    // Check if a given robot is sending you radio.
    isRadioing(robot) {
        return robot.signal >= 0;
    }

    // Get map of visible robot IDs.
    getVisibleRobotMap() {
        return this._bc_game_state.shadow;
    }

    // Get boolean map of passable terrain.
    getPassableMap() {
        return this.map;
    }

    // Get boolean map of karbonite points.
    getKarboniteMap() {
        return this.karbonite_map;
    }

    // Get boolean map of impassable terrain.
    getFuelMap() {
        return this.fuel_map;
    }

    // Get a list of robots visible to you.
    getVisibleRobots() {
        return this._bc_game_state.visible;
    }

    turn() {
        return null;
    }
}

function dist(t,n,i,u){return (i-t)*(i-t)+(u-n)*(u-n)}function distDelta(t,n){return t*t+n*n}function unitDist(t,n,i,u){return Math.abs(i-t)+Math.abs(u-n)}var qmath = {dist, distDelta, unitDist};

function circle(t,e,r,n){for(var i=[],u=bfsDeltas[n],a=u.length,o=0;o<a;o++){var s=e+u[o][0],f=r+u[o][1];inArr(s,f,t.map)&&i.push([s,f]);}return i}function emptyPos(t,e,r,n,i=true){if(inArr(t,e,r))if(!1===i){if(r[e][t]<=0&&!0===n[e][t])return !0}else if(0===r[e][t]&&!0===n[e][t])return !0;return !1}function canPass(t,e,r){var n=t.getPassableMap();return !!inArr(e,r,n)&&n[r][e]}function fuelDeposit(t,e,r){return t.getFuelMap()[r][e]}function karboniteDeposit(t,e,r){return t.getKarboniteMap()[r][e]}function inArr(t,e,r){return !(t<0||e<0||t>=r[0].length||e>=r.length)}function findNearestStructure(t){for(var e=t.getVisibleRobots(),r=1e7,n=null,i=0;i<t.knownStructures[t.me.team].length;i++){var u=t.knownStructures[t.me.team][i];(o=qmath.dist(t.me.x,t.me.y,u.x,u.y))<r&&(r=o,n=u);}for(i=0;i<e.length;i++){var a=e[i];if((a.unit===SPECS.CHURCH||a.unit===SPECS.CASTLE)&&a.team===t.me.team){var o;(o=qmath.dist(t.me.x,t.me.y,a.x,a.y))<r&&(r=o,n={x:a.x,y:a.y,unit:a.unit});}}return null!==n&&n}function findNearestStructureHere(t,e,r,n){var i;i=n||t.getVisibleRobots();for(var u=1e7,a=null,o=0;o<t.knownStructures[t.me.team].length;o++){var s=t.knownStructures[t.me.team][o];(m=qmath.dist(e,r,s.x,s.y))<u&&(u=m,a=s);}for(o=0;o<i.length;o++){var f=i[o];if((f.unit===SPECS.CHURCH||f.unit===SPECS.CASTLE)&&f.team===t.me.team){var m;(m=qmath.dist(e,r,f.x,f.y))<u&&(u=m,a={x:f.x,y:f.y,unit:f.unit});}}return null!==a&&a}function unitsInRadius(t,e,r=t.me.team,n=t.me.x,i=t.me.y){for(var u=t.getVisibleRobots(),a={0:[],1:[],2:[],3:[],4:[],5:[]},o=0;o<u.length;o++){var s=u[o];if(s.team===r){qmath.dist(n,i,s.x,s.y)<=e&&a[s.unit].push(s);}}return a}function horizontalSymmetry(t){for(var e=0;e<4;e++)for(var r=0;r<t[e].length;r++)if(t[e][r]!==t[t.length-e-1][r])return !1;return !0}var bfsDeltas={0:[[0,0]],1:[[0,0],[0,-1],[1,0],[0,1],[-1,0]],2:[[0,0],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],3:[[0,0],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],4:[[0,0],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-2],[2,0],[0,2],[-2,0]]};var search = {circle, bfsDeltas, emptyPos, canPass, fuelDeposit, karboniteDeposit, findNearestStructure, horizontalSymmetry, inArr, unitsInRadius, findNearestStructureHere};

function processMessageCastleTalk(s,t,e){switch(t){case 1:s.allUnits[e]={},s.allUnits[e].unit=t,s.allUnits[e].type="default";break;case 2:s.allUnits[e]={},s.allUnits[e].unit=t,s.allUnits[e].mineLoc=-1,s.allUnits[e].type="miner";break;case 3:case 4:case 5:s.allUnits[e]={},s.allUnits[e].unit=t,s.allUnits[e].type="default";break;case 6:s.allUnits[e]={},s.allUnits[e].unit=2,s.allUnits[e].type="scout",s.rallyTargets[e]={},s.rallyTargets[e].position=[null,null];}}function processMessageCastle(s,t,e){}function processMessageCrusader(s,t){switch(t){case 0:break;case 1:s.status="searchAndAttack";break;case 16390:break;case 16391:"searchAndAttack"!==s.oldStatus&&"searchAndAttack"!==s.status?s.status="defendOldPos":s.status="searchAndAttack",s.defendTarget=s.origStructureLoc;}}function processMessagePreacher(s,t){switch(t){case 0:break;case 1:s.status="searchAndAttack";break;case 5:"waitingForFuelStack"!==s.status&&(s.status="defend");break;case 16390:break;case 16391:"searchAndAttack"!==s.oldStatus&&"searchAndAttack"!==s.status?s.status="defendOldPos":s.status="searchAndAttack",s.defendTarget=s.origStructureLoc;}}function processMessageProphet(s,t){switch(t){case 0:break;case 1:"defend"!==s.status&&(s.status="searchAndAttack");break;case 5:"waitingForFuelStack"!==s.status&&(s.status="defend");break;case 16390:s.status="defend";break;case 16391:s.status="defendOldPos",s.defendTarget=s.origStructureLoc;break;case 24585:s.moveSpeed="fast";}}function processMessageChurch(s,t){}function processMessagePilgrim(s,t){switch(t){case 2:"mineKarb"!==s.status&&"mineFuel"!==s.status&&"frontLineScout"!==s.status&&(s.status="searchForKarbDeposit");break;case 3:"mineKarb"!==s.status&&"mineFuel"!==s.status&&"frontLineScout"!==s.status&&(s.status="searchForFuelDeposit");break;case 24584:"mineKarb"!==s.status&&"mineFuel"!==s.status&&"frontLineScout"!==s.status&&(s.status="searchForAnyDeposit",s.searchAny=!0);}}var signal = {processMessageCastleTalk, processMessageCastle, processMessageCrusader, processMessagePreacher, processMessageProphet, processMessageChurch, processMessagePilgrim};

function dist$1(t,n,i,u){return (i-t)*(i-t)+(u-n)*(u-n)}function distDelta$1(t,n){return t*t+n*n}function unitDist$1(t,n,i,u){return Math.abs(i-t)+Math.abs(u-n)}var qmath$1 = {dist: dist$1, distDelta: distDelta$1, unitDist: unitDist$1};

function circle$1(t,e,r,n){for(var i=[],u=bfsDeltas$1[n],a=u.length,o=0;o<a;o++){var s=e+u[o][0],f=r+u[o][1];inArr$1(s,f,t.map)&&i.push([s,f]);}return i}function emptyPos$1(t,e,r,n,i=true){if(inArr$1(t,e,r))if(!1===i){if(r[e][t]<=0&&!0===n[e][t])return !0}else if(0===r[e][t]&&!0===n[e][t])return !0;return !1}function canPass$1(t,e,r){var n=t.getPassableMap();return !!inArr$1(e,r,n)&&n[r][e]}function fuelDeposit$1(t,e,r){return t.getFuelMap()[r][e]}function karboniteDeposit$1(t,e,r){return t.getKarboniteMap()[r][e]}function inArr$1(t,e,r){return !(t<0||e<0||t>=r[0].length||e>=r.length)}function findNearestStructure$1(t){for(var e=t.getVisibleRobots(),r=1e7,n=null,i=0;i<t.knownStructures[t.me.team].length;i++){var u=t.knownStructures[t.me.team][i];(o=qmath.dist(t.me.x,t.me.y,u.x,u.y))<r&&(r=o,n=u);}for(i=0;i<e.length;i++){var a=e[i];if((a.unit===SPECS.CHURCH||a.unit===SPECS.CASTLE)&&a.team===t.me.team){var o;(o=qmath.dist(t.me.x,t.me.y,a.x,a.y))<r&&(r=o,n={x:a.x,y:a.y,unit:a.unit});}}return null!==n&&n}function findNearestStructureHere$1(t,e,r,n){var i;i=n||t.getVisibleRobots();for(var u=1e7,a=null,o=0;o<t.knownStructures[t.me.team].length;o++){var s=t.knownStructures[t.me.team][o];(m=qmath.dist(e,r,s.x,s.y))<u&&(u=m,a=s);}for(o=0;o<i.length;o++){var f=i[o];if((f.unit===SPECS.CHURCH||f.unit===SPECS.CASTLE)&&f.team===t.me.team){var m;(m=qmath.dist(e,r,f.x,f.y))<u&&(u=m,a={x:f.x,y:f.y,unit:f.unit});}}return null!==a&&a}function unitsInRadius$1(t,e,r=t.me.team,n=t.me.x,i=t.me.y){for(var u=t.getVisibleRobots(),a={0:[],1:[],2:[],3:[],4:[],5:[]},o=0;o<u.length;o++){var s=u[o];if(s.team===r){qmath.dist(n,i,s.x,s.y)<=e&&a[s.unit].push(s);}}return a}function horizontalSymmetry$1(t){for(var e=0;e<4;e++)for(var r=0;r<t[e].length;r++)if(t[e][r]!==t[t.length-e-1][r])return !1;return !0}var bfsDeltas$1={0:[[0,0]],1:[[0,0],[0,-1],[1,0],[0,1],[-1,0]],2:[[0,0],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],3:[[0,0],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],4:[[0,0],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-2],[2,0],[0,2],[-2,0]]};var search$1 = {circle: circle$1, bfsDeltas: bfsDeltas$1, emptyPos: emptyPos$1, canPass: canPass$1, fuelDeposit: fuelDeposit$1, karboniteDeposit: karboniteDeposit$1, findNearestStructure: findNearestStructure$1, horizontalSymmetry: horizontalSymmetry$1, inArr: inArr$1, unitsInRadius: unitsInRadius$1, findNearestStructureHere: findNearestStructureHere$1};

function rel(t,n,u,e){return {dx:u-t,dy:e-n}}function relToPos(t,n,u,e,r,o=false,l=true){var a=unitMoveDeltas[r.me.unit];!1===l&&(a=unitMoveDeltas[r.me.unit].slice(0,9));for(var s=r.getVisibleRobotMap(),i=qmath.dist(u,e,t,n),c=[0,0],v=0;v<a.length;v++){var f=t+a[v][0],k=n+a[v][1];if(!0===r.canMove(a[v][0],a[v][1])){var S=!0;if(o)for(var d=search$1.circle(r,f,k,2),h=1;h<d.length;h++){var m=d[h],y=r.getRobot(s[m[1]][m[0]]);null!==y&&y.team===r.me.team&&y.id!==r.me.id&&(S=!1);}if(S){var w=qmath.dist(f,k,u,e);w<i&&(i=w,c=a[v]);}}}return {dx:c[0],dy:c[1]}}function logStructure(t,n,u,e,r,o=true){for(var l=!1,a=0;a<t.knownStructures[e].length;a++){var s=t.knownStructures[e][a];if(n===s.x&&u===s.y){l=!0;break}}!1===l&&(!0===o?t.knownStructures[e].push({x:n,y:u,unit:r}):t.knownStructures[e].unshift({x:n,y:u,unit:r}));}function updateKnownStructures(t){for(var n=t.getVisibleRobotMap(),u=0;u<2;u++){for(var e=[],r=0;r<t.knownStructures[u].length;r++){var o=t.knownStructures[u][r],l=n[o.y][o.x],a=t.getRobot(l);null===a?e.push(o):a.unit===o.unit?e.push(o):u!==t.me.team&&(t.mapIsHorizontal?t.castleTalk(7+o.x):t.castleTalk(7+o.y),t.destroyedCastle=!0);}t.knownStructures[u]=e;}for(var s=0;s<t.knownStructures[1].length;s++);}function destroyedCastle(t){}var unitMoveDeltas={0:null,1:null,2:[[0,0],[0,-1],[1,0],[0,1],[-1,0],[1,-1],[1,1],[-1,1],[-1,-1],[0,-2],[2,0],[0,2],[-2,0]],3:[[0,0],[0,-1],[1,0],[0,1],[-1,0],[1,-1],[1,1],[-1,1],[-1,-1],[0,-2],[2,0],[0,2],[-2,0],[1,-2],[1,2],[-1,2],[-1,-2],[2,-2],[2,2],[-2,2],[-2,-2],[0,-3],[3,0],[0,3],[-3,0]],4:[[0,0],[0,-1],[1,0],[0,1],[-1,0],[1,-1],[1,1],[-1,1],[-1,-1],[0,-2],[2,0],[0,2],[-2,0]],5:[[0,0],[0,-1],[1,0],[0,1],[-1,0],[1,-1],[1,1],[-1,1],[-1,-1],[0,-2],[2,0],[0,2],[-2,0]]};var base = {rel, relToPos, unitMoveDeltas, logStructure, updateKnownStructures, destroyedCastle};

function mind(e){var t=e.getVisibleRobotMap(),s=e.getPassableMap(),i=e.getVisibleRobots(),a=e.map,l=e.map.length,n="",u=(e.me.team+1)%2,r=(e.getVisibleRobotMap(),e.getKarboniteMap()),o=e.getFuelMap();if(1===e.me.turn){e.occupiedMiningLocationsIndices={},e.rallyTargets={},e.lastRallySignal=-1,e.castleHasScout=!1,e.myScoutsId=-1,e.sentContestableBot=!1,e.newIndices=[],e.finalSignal=!1,e.minKarbonite=200,e.minFuel=50;var c=0;e.castleNum=0,90===e.karbonite?(c=1,e.castleNum=1):80===e.karbonite&&(c=2,e.castleNum=2),e.castles=i.length-c,e.castleCount=e.castles,e.maxScoutingPilgrims=e.castleCount,e.currentScoutingPilgrims=0,e.mapIsHorizontal=search.horizontalSymmetry(a),e.initializeCastleLocations(),e.stackFuel=!1,e.oppositeCastleDestroyed=!1,e.pastBuildQueue=[];for(var h=null,p=999999,m=0;m<l;m++)for(var d=0;d<l;d++)if(!0===o[m][d]&&(e.fuelSpots.push({x:d,y:m}),e.allSpots.push({x:d,y:m,type:"fuel"})),!0===r[m][d]){e.karboniteSpots.push({x:d,y:m}),e.allSpots.push({x:d,y:m,type:"karbonite"});var f=qmath$1.dist(d,m,e.me.x,e.me.y);f<p&&(p=f,h=[d,m]);}var g=e.fuelSpots.length;e.maxPilgrims=Math.ceil((g+e.karboniteSpots.length)/2),e.maxHalf=Math.ceil((g+e.karboniteSpots.length)/2),e.mapIsHorizontal?(e.halfPoint=l/2,e.me.y<l/2?e.lowerHalf=!0:e.lowerHalf=!1):(e.halfPoint=l/2,e.me.x<l/2?e.lowerHalf=!0:e.lowerHalf=!1),e.contestableSpots=[];for(m=0;m<e.karboniteSpots.length;m++){var S,b=e.karboniteSpots[m];S=e.mapIsHorizontal?[b.x,l-b.y-1]:[l-b.x-1,b.y],ownHalf(e,b.x,b.y)&&qmath$1.dist(b.x,b.y,S[0],S[1])<=64&&e.contestableSpots.push(b);}e.closestContestableSpot=null,e.status="build",e.canBuildPilgrims=!0,e.initialCastleLocationMessages={};e.castleIds=[];for(m=0;m<i.length;m++){(v=i[m].castle_talk)>=0&&(e.allUnits[i[m].id]={},e.allUnits[i[m].id].unit=0,e.allUnits[i[m].id].type="default",e.castleIds.push(i[m].id),e.initialCastleLocationMessages[i[m].id]={},e.initialCastleLocationMessages[i[m].id].x=-1,e.initialCastleLocationMessages[i[m].id].y=-1),e.sawEnemyLastTurn=!1;}null!==e.closestContestableSpot?3===e.castles?0===c?e.buildQueue.push(2,2):1===c?e.buildQueue.push(2):2===c&&e.buildQueue.push(2):2===e.castles?0===c?e.buildQueue.push(2,2):1===c&&e.buildQueue.push(2):1===e.castles&&e.buildQueue.push(2,2,2):3===e.castles?0===c?e.buildQueue.push(2,2):1===c?e.buildQueue.push(2):2===c&&e.buildQueue.push(2):2===e.castles?0===c?e.buildQueue.push(2,2):1===c&&e.buildQueue.push(2,2):1===e.castles&&e.buildQueue.push(2,2,2,2);var y=[e.knownStructures[u][0].x,e.knownStructures[u][0].y],P=search.circle(e,e.me.x,e.me.y,2),E=y[0],x=y[1],Q=[];e.buildingAttackUnitPositions=[],e.buildingPilgrimPositions=[];for(m=0;m<P.length;m++)P[m][0]===e.me.x&&P[m][1]===e.me.y||Q.push({pos:P[m],dist:qmath$1.dist(P[m][0],P[m][1],E,x)});Q.sort(function(e,t){return e.dist-t.dist}),e.buildingAttackUnitPositions=Q.map(function(e){return e.pos}),Q=[],E=h[0],x=h[1];for(m=0;m<P.length;m++)P[m][0]===e.me.x&&P[m][1]===e.me.y||Q.push({pos:P[m],dist:qmath$1.dist(P[m][0],P[m][1],E,x)});Q.sort(function(e,t){return e.dist-t.dist}),e.buildingPilgrimPositions=Q.map(function(e){return e.pos});}if(e.me.turn<=3){if(1===e.me.turn){var C=e.me.x+192;e.castleTalk(C);}else if(2===e.me.turn){var k=e.me.y+192;e.castleTalk(k);}for(m=0;m<i.length;m++){for(var v=i[m].castle_talk,R=i[m].id,M=!1,H=0;H<e.castleIds.length;H++)if(R===e.castleIds[H]){M=!0;break}M&&v>=192&&(-1===e.initialCastleLocationMessages[R].x?e.initialCastleLocationMessages[R].x=v-192:e.initialCastleLocationMessages[R].y=v-192);}}var T=!1,I=!1;if(3===e.me.turn){I=!0;var w=!0;e.enemyCastlesSorted=[];for(m=0;m<e.castleIds.length;m++){var L=e.castleIds[m],U=e.initialCastleLocationMessages[L].x,A=e.initialCastleLocationMessages[L].y;if(-1!==U&&-1!==A){base.logStructure(e,U,A,e.me.team,0);var K=U,O=l-A-1,q=Math.abs(O-A);e.mapIsHorizontal||(K=l-U-1,O=A,q=Math.abs(K-U)),q<=31&&(w=!1),base.logStructure(e,K,O,u,0);}}for(m=0;m<i.length;m++){76===(v=i[m].castle_talk)&&(I=!1);}if(!0===I){var B=99999,F=99998,N=null,D=[];for(m=1;m<e.knownStructures[e.me.team].length;m++){var _=e.knownStructures[e.me.team][m];D.push([_.x,_.y]);}for(m=0;m<e.contestableSpots.length;m++){b=e.contestableSpots[m];var z=qmath$1.dist(b.x,b.y,e.me.x,e.me.y);B>=z&&(B=z,N=b);for(m=0;m<D.length;m++){var V=D[m][0],G=D[m][1],j=qmath$1.dist(b.x,b.y,V,G);F>=j&&(F=j);}}B<=F&&(e.castleTalk(76),e.closestContestableSpot=N,T=!0);}!0===w&&e.buildQueue.push(2,2);}e.status="build",e.canBuildPilgrims=!0,e.canBuildPreachers=!0,e.stackFuel=!1,e.stackKarbonite=!1,e.numPilgrimsMiningKarbonite=0,e.numPilgrimsMiningFuel=0;var J=[];e.searchQueue=[];for(m=0;m<e.fuelSpots.length;m++){if(safeDeposit(e,U=e.fuelSpots[m].x,A=e.fuelSpots[m].y)){var W=[],X=0;X=null!==e.planner?e.planner.search(e.me.y,e.me.x,A,U,W):qmath$1.dist(e.me.x,e.me.y,U,A),e.searchQueue.push({position:[U,A],distance:X,type:"fuel"});}}for(m=0;m<e.karboniteSpots.length;m++){var Y=!0;if(safeDeposit(e,U=e.karboniteSpots[m].x,A=e.karboniteSpots[m].y)){W=[],X=0;X=null!==e.planner?e.planner.search(e.me.y,e.me.x,A,U,W):qmath$1.dist(e.me.x,e.me.y,U,A),e.searchQueue.push({position:[U,A],distance:X,type:"karbonite"});}}for(m=0;m<i.length;m++){v=i[m].castle_talk;var Z=i[m].id;if(v>=77&&void 0!==e.allUnits[Z]&&(e.allUnits[Z].unit===SPECS.PROPHET||e.allUnits[Z].unit===SPECS.PILGRIM&&"miner"===e.allUnits[Z].type)){var $=v-77,ee=e.allSpots[$];X=qmath$1.dist(e.me.x,e.me.y,ee.x,ee.y);e.allSpots[$].safe=!0,e.searchQueue.push({position:[ee.x,ee.y],distance:X,type:ee.type});}}var te=[];for(m=0;m<e.searchQueue.length;m++){var se=!0,ie=e.searchQueue[m],ae=ie.position;for(d=0;d<te.length;d++){var le=te[d];if(le.position[0]===ae[0]&&le.position[1]===ae[1]){se=!1;break}}!0===se&&te.push(ie);}e.searchQueue=te,e.searchQueue.sort(function(e,t){return e.distance-t.distance}),e.maxPilgrims=Math.max(e.searchQueue.length,e.maxHalf);for(var ne in e.occupiedMiningLocationsIndices){var ue=e.occupiedMiningLocationsIndices[ne];"fuel"===e.allSpots[ue].type?e.numPilgrimsMiningFuel+=1:"karbonite"===e.allSpots[ue].type&&(e.numPilgrimsMiningKarbonite+=1);}var re=[];if(e.me.turn>3){for(m=0;m<i.length;m++){v=i[m].castle_talk,Z=i[m].id;v>=77&&void 0!==e.allUnits[Z]&&(e.allUnits[Z].unit!==SPECS.CASTLE&&e.allUnits[Z].unit!==SPECS.CHURCH||e.newIndices.push({msg:v-77,turn:e.me.turn}));}var oe=[];for(m=0;m<e.newIndices.length;m++){var ce=e.newIndices[m];e.me.turn-ce.turn<=1&&oe.push(ce);}e.newIndices=oe;for(m=0;m<e.searchQueue.length;m++){var he=e.searchQueue[m].position,pe=!0;for(var ne in e.occupiedMiningLocationsIndices){ue=e.occupiedMiningLocationsIndices[ne];if(he[0]===e.allSpots[ue].x&&he[1]===e.allSpots[ue].y){pe=!1;break}}if(!0===pe)for(H=0;H<e.newIndices.length;H++){ue=e.newIndices[H].msg;if(he[0]===e.allSpots[ue].x&&he[1]===e.allSpots[ue].y){pe=!1;break}}!0===pe&&re.push(e.searchQueue[m]);}e.searchQueue=re;}e.searchQueueFuel=e.searchQueue.filter(function(e){return "fuel"===e.type}),e.searchQueueKarbonite=e.searchQueue.filter(function(e){return "karbonite"===e.type});for(m=0;m<i.length;m++){v=i[m].castle_talk,i[m].signal;J.push(i[m].id);var me=i[m].id;if(signal.processMessageCastleTalk(e,v,me),v>=0&&void 0===e.allUnits[me]&&(e.allUnits[me]={}),v>=77&&v<=236&&e.allUnits[me].unit===SPECS.PILGRIM&&"miner"===e.allUnits[me].type&&(e.allUnits[me].mineLoc=v-77,e.occupiedMiningLocationsIndices[me]=e.allUnits[me].mineLoc),v>=1){if("scout"===e.allUnits[me].type)if(v>=7&&v<=70)e.rallyTargets[me].position[0]=v-7;else if(v>=71&&v<=134)e.rallyTargets[me].position[1]=v-71;else if(6===v){var de=e.getRobot(me);null!==de&&qmath$1.dist(e.me.x,e.me.y,de.x,de.y)<=16&&(e.myScoutsId=me);}if("default"===e.allUnits[me].type||"miner"===e.allUnits[me].type)if(v>=7&&v<=70){var fe=v-7;for(m=0;m<e.knownStructures[u].length;m++)if(e.mapIsHorizontal){if(e.knownStructures[u][m].x===fe){fe===e.me.x&&(e.oppositeCastleDestroyed=!0),e.knownStructures[u].splice(m,1);break}}else if(e.knownStructures[u][m].y===fe){fe===e.me.y&&(e.oppositeCastleDestroyed=!0),e.knownStructures[u].splice(m,1);break}for(m=0;m<e.knownStructures[u].length;m++);}else 71===v?(e.karbonite<=90&&(e.stackKarbonite=!0,e.buildQueue=[]),e.fuel<=200&&(e.stackFuel=!0,e.buildQueue=[])):72===v&&me!==e.me.id&&(e.status="pause");}}for(var ge in e.rallyTargets)H=e.rallyTargets[ge];e.castles=0,e.pilgrims=0,e.scouts=0,e.crusaders=0,e.churches=0,e.prophets=0,e.preachers=0,e.churchesThatBuild=0;for(var Z in e.allUnits){var Se=!1;for(H=0;H<J.length;H++)if(J[H]==Z){Se=!0;break}if(!0===Se)switch(e.allUnits[Z].unit){case 0:e.castles+=1;break;case 1:e.churches+=1;break;case 2:"scout"===e.allUnits[Z].type?e.scouts+=1:e.pilgrims+=1;break;case 3:e.crusaders+=1;break;case 4:e.prophets+=1;break;case 5:e.preachers+=1;break;case 75:e.churchesThatBuild+=1;}else delete e.occupiedMiningLocationsIndices[Z],delete e.allUnits[Z],delete e.rallyTargets[Z],Z==e.myScoutsId&&(e.castleHasScout=!1,e.myScoutsId=-1);}var be={0:[],1:[],2:[],3:[],4:[],5:[]},ye={0:0,1:0,2:0,3:0,4:0,5:0};for(m=0;m<i.length;m++){if((Ze=i[m]).team===e.me.team){(Ue=qmath$1.dist(e.me.x,e.me.y,Ze.x,Ze.y))<=100&&(be[Ze.unit].push(Ze),Ue>ye[Ze.unit]&&(ye[Ze.unit]=Ue));}}for(m=0;m<i.length;m++){v=i[m].castle_talk,me=i[m].id;if(4===i[m].signal&&i[m].team===e.me.team){var Pe=e.searchQueue,Ee=!1,xe=!1,Qe=i[m];!0===o[Qe.y][Qe.x]?Ee=!0:!0===r[Qe.y][Qe.x]&&(xe=!0);Y=!0;if(e.pilgrims<=e.maxPilgrims?e.numPilgrimsMiningFuel<e.fuelSpots.length/2&&(e.karbonite>100||e.fuel<70*e.prophets+10*e.pilgrims||e.fuel<=400+400*e.churches)?(e.signal(3,2),e.searchQueueFuel.length&&(Pe=e.searchQueueFuel),Ee&&(Y=!1)):e.numPilgrimsMiningKarbonite<e.karboniteSpots.length/2&&e.karbonite<=100?(e.signal(2,2),e.searchQueueKarbonite.length&&(Pe=e.searchQueueKarbonite),xe&&(Y=!1)):(e.signal(24584,2),(Ee||xe)&&(Y=!1)):e.signal(24584,2),Pe.length&&!0===Y){var Ce=28842,ke=getIndexAllSpots(e,Pe[0].position);e.signal(Ce+ke,2),e.castleTalk(77+ke);}else e.signal(24584,2);}if(135===v&&"scout"===e.allUnits[me].type&&be[SPECS.PROPHET].length>=12){var ve=null;if(void 0!==(je=e.rallyTargets[e.myScoutsId])&&void 0!==je.position&&null!==je.position[0]&&null!==je.position[1]&&(ve=je.position),null!==ve&&e.lastRallySignal<e.me.turn-5){Ce=29003;var Re=e.compressLocation(ve[0],ve[1]);e.signal(Ce+Re,64),e.lastRallySignal=e.me.turn;}}}var Me=!1,He=!1,Te=null,Ie=1e3,we=!1,Le=!1;for(m=0;m<i.length;m++){if((Ze=i[m]).unit===SPECS.CRUSADER)var Ue=qmath$1.dist(e.me.x,e.me.y,Ze.x,Ze.y);else if(Ze.unit===SPECS.PREACHER)Ue=qmath$1.dist(e.me.x,e.me.y,Ze.x,Ze.y);else if(Ze.unit===SPECS.PROPHET)Ue=qmath$1.dist(e.me.x,e.me.y,Ze.x,Ze.y);if(Ze.team===u&&Ze.unit!==SPECS.PILGRIM){(Ue=qmath$1.dist(e.me.x,e.me.y,Ze.x,Ze.y))<Ie&&(Ze.unit===SPECS.PROPHET?we=!0:Ze.unit===SPECS.CRUSADER?He=!0:Ze.unit===SPECS.PREACHER&&(Le=!0),Te={x:Ze.x,y:Ze.y},Ie=Ue,Me=!0);}}var Ae=!1;if(!1===Me&&!0===e.sawEnemyLastTurn){var Ke=64;Ke=Math.min(Math.max(Math.pow(Math.ceil(Math.sqrt(Math.max(ye[SPECS.PROPHET],ye[SPECS.PREACHER]))),2),4),64),e.signal(16391,Ke);}if(!0===e.castleHasScout?(e.minKarbonite=900,e.minFuel=200):(e.minKarbonite=200,e.minFuel=50),e.castles>1)if(!1===Me&&e.me.turn>4&&!1===e.stackKarbonite&&!1===e.stackFuel)e.pilgrims<=e.maxPilgrims&&e.karbonite>=100?e.buildQueue=[2]:e.karbonite>=e.minKarbonite&&e.fuel>(e.prophets+e.preachers)*e.minFuel&&((be[SPECS.PROPHET].length<=e.prophets/e.castles||e.karbonite>e.minKarbonite+90)&&"pause"!==e.status&&(e.buildQueue=[4],e.prophets>15*e.crusaders&&(e.buildQueue=[3])),be[SPECS.PROPHET].length>=11&&!1===e.oppositeCastleDestroyed&&!0===e.castleHasScout||!1===e.castleHasScout&&be[SPECS.PROPHET].length>=11&&(Ae=!0,e.buildQueue=[2])),e.sawEnemyLastTurn=!1;else if(!0===Me){var Oe=e.compressLocation(Te.x,Te.y);Ce=12294;!0===we&&(Ce=16392);Ke=64;Ke=Math.min(Math.max(Math.pow(Math.ceil(Math.sqrt(Math.max(ye[SPECS.PROPHET],ye[SPECS.PREACHER]))),2),4),64),e.signal(Ce+Oe,Ke),e.sawEnemyLastTurn=!0,e.status="build",e.me.turn>0&&(!0===He?be[SPECS.PREACHER].length<1?e.buildQueue.unshift(5):e.buildQueue.unshift(4):!0===Le?be[SPECS.PROPHET].length<1?e.buildQueue.unshift(4):be[SPECS.PREACHER].length<1?e.buildQueue.unshift(5):e.fuel>=75*be[SPECS.PROPHET].length+125&&e.buildQueue.unshift(4):e.fuel>=200&&e.buildQueue.unshift(4));}else!1===Me&&(e.sawEnemyLastTurn=!1);else if(!1===Me&&e.me.turn>4&&!1===e.stackKarbonite&&!1===e.stackFuel){!0===e.sawEnemyLastTurn&&(e.signal(16391,64),e.buildQueue=[]);e.buildQueue.forEach(function(e){}),e.pilgrims<=e.maxPilgrims&&e.karbonite>=100?e.buildQueue=[2]:e.karbonite>=e.minKarbonite&&e.fuel>(e.prophets+e.preachers)*e.minFuel&&(e.buildQueue=[4],e.prophets>15*e.crusaders&&(e.buildQueue=[3]),be[SPECS.PROPHET].length>=11&&!1===e.oppositeCastleDestroyed&&!0===e.castleHasScout||!1===e.castleHasScout&&be[SPECS.PROPHET].length>=11&&(Ae=!0,e.buildQueue=[2])),e.sawEnemyLastTurn=!1;}else if(!0===Me){Oe=e.compressLocation(Te.x,Te.y),Ce=12294;!0===we&&(Ce=16392);Ke=64;Ke=Math.min(Math.max(Math.pow(Math.ceil(Math.sqrt(Math.max(ye[SPECS.PROPHET],ye[SPECS.PREACHER]))),2),4),64),e.signal(Ce+Oe,Ke),e.sawEnemyLastTurn=!0,e.status="build",e.me.turn>0&&(!0===He?be[SPECS.PREACHER].length<1?e.buildQueue.unshift(5):e.buildQueue.unshift(4):!0===Le?be[SPECS.PROPHET].length<1?e.buildQueue.unshift(4):be[SPECS.PREACHER].length<1?e.buildQueue.unshift(5):e.fuel>=75*be[SPECS.PROPHET].length+125&&e.buildQueue.unshift(4):e.fuel>=200&&e.buildQueue.unshift(4));}else!1===Me&&(e.sawEnemyLastTurn=!1);if(e.me.turn>=920&&e.castles<e.castleCount&&!1===e.finalSignal){var Be=e.knownStructures[u][0];Oe=e.compressLocation(Be.x,Be.y),Ce=20488;e.finalSignal=!0,e.signal(Ce+Oe,100);}else e.me.turn>=920&&e.fuel>=1e3&&(e.buildQueue=[3]);if((e.fuel<=50*e.preachers+60*e.prophets||e.fuel<=100)&&!1===Me&&(e.status="pause"),"build"===e.status)if(!0===T&&e.buildQueue.unshift(4),-1!==e.buildQueue[0]){var Fe=!1,Ne=[];if(2===e.buildQueue[0]){Ne=e.buildingPilgrimPositions;var De=e.searchQueue;if(e.searchQueueKarbonite.length&&(De=e.searchQueueKarbonite),De.length){var _e=De[0].position,ze=Ne.map(function(e){return {pos:e,dist:qmath$1.dist(e[0],e[1],_e[0],_e[1])}});ze.sort(function(e,t){return e.dist-t.dist}),Ne=ze.map(function(e){return e.pos});}}else Ne=e.buildingAttackUnitPositions;if(4===e.buildQueue[0]&&Me&&(Fe=!0),!1===Fe)for(m=0;m<Ne.length;m++){if(canBuild(e,(We=Ne[m])[0],We[1],t,s)&&e.buildQueue.length>0&&enoughResourcesToBuild(e,e.buildQueue[0])){var Ve=e.buildQueue.shift();if(3===e.me.turn&&!0===I&&null!==e.closestContestableSpot){Ce=24586;var Ge=e.compressLocation(e.closestContestableSpot.x,e.closestContestableSpot.y);ke=getIndexAllSpots(e,[e.closestContestableSpot.x,e.closestContestableSpot.y]);e.signal(Ce+Ge,2),e.castleTalk(77+ke);}if(2===Ve&&e.searchQueue.length&&3!==e.me.turn&&!1===Ae)if(e.me.turn>3){Pe=e.searchQueue;e.searchQueueKarbonite.length&&(Pe=e.searchQueueKarbonite);Ce=28682,ke=getIndexAllSpots(e,Pe[0].position);2!==e.me.turn&&(e.signal(Ce+ke,2),e.castleTalk(77+ke));}else e.signal(2,2);else 2===Ve&&!0===Ae&&(e.signal(29002,2),e.castleHasScout=!0);if(3===Ve){var je;ve=null;if(void 0!==(je=e.rallyTargets[e.myScoutsId])&&null!==je.position[0]&&null!==je.position[1]&&(ve=je.position),null!==ve)Ce=29003,Re=e.compressLocation(ve[0],ve[1]);}e.pastBuildQueue.push(Ve),e.pastBuildQueue.length>=10&&e.pastBuildQueue.shift();var Je=base.rel(e.me.x,e.me.y,We[0],We[1]);return n=e.buildUnit(Ve,Je.dx,Je.dy),{action:n}}}else if(!0===Fe)for(m=Ne.length-1;m>=0;m--){var We;if(canBuild(e,(We=Ne[m])[0],We[1],t,s)&&e.buildQueue.length>0&&enoughResourcesToBuild(e,e.buildQueue[0])){Ve=e.buildQueue.shift();e.pastBuildQueue.push(Ve),e.pastBuildQueue.length>=10&&e.pastBuildQueue.shift();Je=base.rel(e.me.x,e.me.y,We[0],We[1]);return n=e.buildUnit(Ve,Je.dx,Je.dy),{action:n}}}}else e.buildQueue.shift();e.status;var Xe=null,Ye=99999;for(m=0;m<i.length;m++){var Ze;if((Ze=i[m]).team!==e.me.team){var $e=qmath$1.dist(e.me.x,e.me.y,Ze.x,Ze.y);$e<Ye&&$e<=64&&(Ye=$e,Xe=Ze);}}if(null!==Xe){Je=base.rel(e.me.x,e.me.y,Xe.x,Xe.y);return {action:e.attack(Je.dx,Je.dy)}}return {action:"",status:"build",response:""}}function canBuild(e,t,s,i,a){return !(!search.inArr(t,s,i)||0!==i[s][t]||!0!==a[s][t])}function safeDeposit(e,t,s){if(ownHalf(e,t,s))return !0;e.getVisibleRobotMap();var i=search.unitsInRadius(e,64,e.me.team,t,s);if(i[SPECS.PROPHET].length+i[SPECS.PREACHER].length>=1)return !0;var a=search.findNearestStructure(e);return qmath$1.dist(t,s,a.x,a.y)<=9}function enoughResourcesToBuild(e,t){var s=SPECS.UNITS[t].CONSTRUCTION_FUEL,i=SPECS.UNITS[t].CONSTRUCTION_KARBONITE;return s<=e.fuel&&i<=e.karbonite}function ownHalf(e,t,s){var i=e.map,a=i.length;if(e.mapIsHorizontal){if(e.lowerHalf){if(s<a/2)return !0}else if(s>=a/2)return !0}else if(e.lowerHalf){if(t<i[0].length/2)return !0}else if(t>=i[0].length/2)return !0;return !1}function getIndexAllSpots(e,t){for(var s=0;s<e.allSpots.length;s++){var i=e.allSpots[s];if(i.x===t[0]&&i.y===t[1])return s}return null}var castle = {mind};

function initializePlanner(r){for(var t=r.map,a=r.map[0].length,e=r.map.length,s=new Int8Array(a*e),n=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]],i=0;i<e;i++)for(var o=0;o<a;o++){var h=o+i*a;if(!1===t[i][o]){for(var u=0,f=[],c=0;c<n.length;c++){var l=n[c],p=i+l[1],g=o+l[0];if(g<0||p<0||g>=t[0].length||p>=t.length)f.push(!0);else{!1===t[i+l[1]][o+l[0]]?(u+=1,f.push(!1)):f.push(!0);}}s[h]=u<=2?0:1;}}var d=ndarray(s,[a,e]),y=createPlanner(d);r.planner=y;}!function(){function r(t,a,e){function s(i,o){if(!a[i]){if(!t[i]){var h="function"==typeof require&&require;if(!o&&h)return h(i,!0);if(n)return n(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var f=a[i]={exports:{}};t[i][0].call(f.exports,function(r){return s(t[i][1][r]||r)},f,f.exports,r,t,a,e);}return a[i].exports}for(var n="function"==typeof require&&require,i=0;i<e.length;i++)s(e[i]);return s}return r}()({1:[function(r,t,a){function e(r,t,a,e,s,n){var i=["function ",r,"(a,l,h,",e.join(","),"){",n?"":"var i=",a?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",s?".get(m)":"[m]"];return n?t.indexOf("c")<0?i.push(";if(x===y){return m}else if(x<=y){"):i.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):i.push(";if(",t,"){i=m;"),a?i.push("l=m+1}else{h=m-1}"):i.push("h=m-1}else{l=m+1}"),i.push("}"),n?i.push("return -1};"):i.push("return i};"),i.join("")}function s(r,t,a,s){return new Function([e("A","x"+r+"y",t,["y"],!1,s),e("B","x"+r+"y",t,["y"],!0,s),e("P","c(x,y)"+r+"0",t,["y","c"],!1,s),e("Q","c(x,y)"+r+"0",t,["y","c"],!0,s),"function dispatchBsearch",a,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",a].join(""))()}t.exports={ge:s(">=",!1,"GE"),gt:s(">",!1,"GT"),lt:s("<",!0,"LT"),le:s("<=",!0,"LE"),eq:s("-",!0,"EQ",!0)};},{}],2:[function(r,t,a){function e(r,t,a,e){this.start=r,this.end=t,this.direction=a,this.height=e,this.visited=!1,this.next=null,this.prev=null;}function s(r,t,a,e){this.x=r,this.y=t,this.segment=a,this.orientation=e;}function n(r,t){var a=r.shape[0],s=r.shape[1],n=[],i=!1,o=!1,h=!1,u=!1,f=0,c=0,l=0;for(l=0;l<s;++l)(o=!!r.get(0,l))!==i&&(i&&n.push(new e(f,l,t,0)),o&&(f=l),i=o);for(i&&n.push(new e(f,l,t,0)),c=1;c<a;++c){for(i=!1,o=!1,f=0,l=0;l<s;++l)h=!!r.get(c-1,l),u=!!r.get(c,l),h===i&&u===o||(i!==o&&(i?n.push(new e(l,f,t,c)):n.push(new e(f,l,t,c))),h!==u&&(f=l),i=h,o=u);i!==o&&(i?n.push(new e(l,f,t,c)):n.push(new e(f,l,t,c)));}for(i=!1,f=0,l=0;l<s;++l)(o=!!r.get(a-1,l))!==i&&(i&&n.push(new e(l,f,t,a)),o&&(f=l),i=o);return i&&n.push(new e(l,f,t,a)),n}function i(r){for(var t=new Array(2*r.length),a=0;a<r.length;++a){var e=r[a];0===e.direction?(t[2*a]=new s(e.start,e.height,e,0),t[2*a+1]=new s(e.end,e.height,e,1)):(t[2*a]=new s(e.height,e.start,e,0),t[2*a+1]=new s(e.height,e.end,e,1));}return t}function o(r,t){for(var a=[];!r.visited;)r.visited=!0,r.direction?a.push([r.height,r.end]):a.push([r.start,r.height]),r=t?r.next:r.prev;return a}function h(r,t){var a=r.x-t.x;return a||((a=r.y-t.y)||r.orientation-t.orientation)}t.exports=function(r,t){t=!!t;var a=n(r,0),e=i(a);e.sort(h);var s=i(n(r.transpose(1,0),1));s.sort(h);for(var u=e.length,f=0;f<u;++f){var c=e[f],l=s[f];c.orientation?(c.segment.next=l.segment,l.segment.prev=c.segment):(c.segment.prev=l.segment,l.segment.next=c.segment);}var p=[];for(f=0;f<a.length;++f)(c=a[f]).visited||p.push(o(c,t));return p};},{}],3:[function(r,t,a){var e=r("./lib/thunk.js");t.exports=function(r){var t=new function(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1;};t.pre=r.pre,t.body=r.body,t.post=r.post;var a=r.args.slice(0);t.argTypes=a;for(var s=0;s<a.length;++s){var n=a[s];if("array"===n||"object"==typeof n&&n.blockIndices){if(t.argTypes[s]="array",t.arrayArgs.push(s),t.arrayBlockIndices.push(n.blockIndices?n.blockIndices:0),t.shimArgs.push("array"+s),s<t.pre.args.length&&t.pre.args[s].count>0)throw new Error("cwise: pre() block may not reference array args");if(s<t.post.args.length&&t.post.args[s].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===n)t.scalarArgs.push(s),t.shimArgs.push("scalar"+s);else if("index"===n){if(t.indexArgs.push(s),s<t.pre.args.length&&t.pre.args[s].count>0)throw new Error("cwise: pre() block may not reference array index");if(s<t.body.args.length&&t.body.args[s].lvalue)throw new Error("cwise: body() block may not write to array index");if(s<t.post.args.length&&t.post.args[s].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===n){if(t.shapeArgs.push(s),s<t.pre.args.length&&t.pre.args[s].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(s<t.body.args.length&&t.body.args[s].lvalue)throw new Error("cwise: body() block may not write to array shape");if(s<t.post.args.length&&t.post.args[s].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof n||!n.offset)throw new Error("cwise: Unknown argument type "+a[s]);t.argTypes[s]="offset",t.offsetArgs.push({array:n.array,offset:n.offset}),t.offsetArgIndex.push(s);}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>a.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>a.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>a.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!r.printCode||!!r.debug,t.funcName=r.funcName||"cwise",t.blockSize=r.blockSize||64,e(t)};},{"./lib/thunk.js":5}],4:[function(r,t,a){function e(r,t,a){var e,s,n=r.length,i=t.arrayArgs.length,o=t.indexArgs.length>0,h=[],u=[],f=0,c=0;for(e=0;e<n;++e)u.push(["i",e,"=0"].join(""));for(s=0;s<i;++s)for(e=0;e<n;++e)c=f,f=r[e],0===e?u.push(["d",s,"s",e,"=t",s,"p",f].join("")):u.push(["d",s,"s",e,"=(t",s,"p",f,"-s",c,"*t",s,"p",c,")"].join(""));for(u.length>0&&h.push("var "+u.join(",")),e=n-1;e>=0;--e)f=r[e],h.push(["for(i",e,"=0;i",e,"<s",f,";++i",e,"){"].join(""));for(h.push(a),e=0;e<n;++e){for(c=f,f=r[e],s=0;s<i;++s)h.push(["p",s,"+=d",s,"s",e].join(""));o&&(e>0&&h.push(["index[",c,"]-=s",c].join("")),h.push(["++index[",f,"]"].join(""))),h.push("}");}return h.join("\n")}function s(r,t,a){for(var e=r.body,s=[],n=[],i=0;i<r.args.length;++i){var o=r.args[i];if(!(o.count<=0)){var h=new RegExp(o.name,"g"),u="",f=t.arrayArgs.indexOf(i);switch(t.argTypes[i]){case"offset":var c=t.offsetArgIndex.indexOf(i);f=t.offsetArgs[c].array,u="+q"+c;case"array":u="p"+f+u;var l="l"+i,p="a"+f;if(0===t.arrayBlockIndices[f])1===o.count?"generic"===a[f]?o.lvalue?(s.push(["var ",l,"=",p,".get(",u,")"].join("")),e=e.replace(h,l),n.push([p,".set(",u,",",l,")"].join(""))):e=e.replace(h,[p,".get(",u,")"].join("")):e=e.replace(h,[p,"[",u,"]"].join("")):"generic"===a[f]?(s.push(["var ",l,"=",p,".get(",u,")"].join("")),e=e.replace(h,l),o.lvalue&&n.push([p,".set(",u,",",l,")"].join(""))):(s.push(["var ",l,"=",p,"[",u,"]"].join("")),e=e.replace(h,l),o.lvalue&&n.push([p,"[",u,"]=",l].join("")));else{for(var g=[o.name],d=[u],y=0;y<Math.abs(t.arrayBlockIndices[f]);y++)g.push("\\s*\\[([^\\]]+)\\]"),d.push("$"+(y+1)+"*t"+f+"b"+y);if(h=new RegExp(g.join(""),"g"),u=d.join("+"),"generic"===a[f])throw new Error("cwise: Generic arrays not supported in combination with blocks!");e=e.replace(h,[p,"[",u,"]"].join(""));}break;case"scalar":e=e.replace(h,"Y"+t.scalarArgs.indexOf(i));break;case"index":e=e.replace(h,"index");break;case"shape":e=e.replace(h,"shape");}}}return [s.join("\n"),e,n.join("\n")].join("\n").trim()}var n=r("uniq");t.exports=function(r,t){for(var a=t[1].length-Math.abs(r.arrayBlockIndices[0])|0,i=new Array(r.arrayArgs.length),o=new Array(r.arrayArgs.length),h=0;h<r.arrayArgs.length;++h)o[h]=t[2*h],i[h]=t[2*h+1];var u=[],f=[],c=[],l=[],p=[];for(h=0;h<r.arrayArgs.length;++h){r.arrayBlockIndices[h]<0?(c.push(0),l.push(a),u.push(a),f.push(a+r.arrayBlockIndices[h])):(c.push(r.arrayBlockIndices[h]),l.push(r.arrayBlockIndices[h]+a),u.push(0),f.push(r.arrayBlockIndices[h]));for(var g=[],d=0;d<i[h].length;d++)c[h]<=i[h][d]&&i[h][d]<l[h]&&g.push(i[h][d]-c[h]);p.push(g);}var y=["SS"],v=["'use strict'"],b=[];for(d=0;d<a;++d)b.push(["s",d,"=SS[",d,"]"].join(""));for(h=0;h<r.arrayArgs.length;++h){for(y.push("a"+h),y.push("t"+h),y.push("p"+h),d=0;d<a;++d)b.push(["t",h,"p",d,"=t",h,"[",c[h]+d,"]"].join(""));for(d=0;d<Math.abs(r.arrayBlockIndices[h]);++d)b.push(["t",h,"b",d,"=t",h,"[",u[h]+d,"]"].join(""));}for(h=0;h<r.scalarArgs.length;++h)y.push("Y"+h);if(r.shapeArgs.length>0&&b.push("shape=SS.slice(0)"),r.indexArgs.length>0){var _=new Array(a);for(h=0;h<a;++h)_[h]="0";b.push(["index=[",_.join(","),"]"].join(""));}for(h=0;h<r.offsetArgs.length;++h){var m=r.offsetArgs[h],w=[];for(d=0;d<m.offset.length;++d)0!==m.offset[d]&&(1===m.offset[d]?w.push(["t",m.array,"p",d].join("")):w.push([m.offset[d],"*t",m.array,"p",d].join("")));0===w.length?b.push("q"+h+"=0"):b.push(["q",h,"=",w.join("+")].join(""));}var j=n([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));for((b=b.concat(j)).length>0&&v.push("var "+b.join(",")),h=0;h<r.arrayArgs.length;++h)v.push("p"+h+"|=0");r.pre.body.length>3&&v.push(s(r.pre,r,o));var x=s(r.body,r,o),V=function(r){for(var t=0,a=r[0].length;t<a;){for(var e=1;e<r.length;++e)if(r[e][t]!==r[0][t])return t;++t;}return t}(p);V<a?v.push(function(r,t,a,s){for(var n=t.length,i=a.arrayArgs.length,o=a.blockSize,h=a.indexArgs.length>0,u=[],f=0;f<i;++f)u.push(["var offset",f,"=p",f].join(""));for(f=r;f<n;++f)u.push(["for(var j"+f+"=SS[",t[f],"]|0;j",f,">0;){"].join("")),u.push(["if(j",f,"<",o,"){"].join("")),u.push(["s",t[f],"=j",f].join("")),u.push(["j",f,"=0"].join("")),u.push(["}else{s",t[f],"=",o].join("")),u.push(["j",f,"-=",o,"}"].join("")),h&&u.push(["index[",t[f],"]=j",f].join(""));for(f=0;f<i;++f){for(var c=["offset"+f],l=r;l<n;++l)c.push(["j",l,"*t",f,"p",t[l]].join(""));u.push(["p",f,"=(",c.join("+"),")"].join(""));}for(u.push(e(t,a,s)),f=r;f<n;++f)u.push("}");return u.join("\n")}(V,p[0],r,x)):v.push(e(p[0],r,x)),r.post.body.length>3&&v.push(s(r.post,r,o)),r.debug&&console.log("-----Generated cwise routine for ",t,":\n"+v.join("\n")+"\n----------");var A=[r.funcName||"unnamed","_cwise_loop_",i[0].join("s"),"m",V,function(r){for(var t=new Array(r.length),a=!0,e=0;e<r.length;++e){var s=r[e],n=s.match(/\d+/);n=n?n[0]:"",0===s.charAt(0)?t[e]="u"+s.charAt(1)+n:t[e]=s.charAt(0)+n,e>0&&(a=a&&t[e]===t[e-1]);}return a?t[0]:t.join("")}(o)].join("");return new Function(["function ",A,"(",y.join(","),"){",v.join("\n"),"} return ",A].join(""))()};},{uniq:21}],5:[function(r,t,a){var e=r("./compile.js");t.exports=function(r){var t=["'use strict'","var CACHED={}"],a=[],s=r.funcName+"_cwise_thunk";t.push(["return function ",s,"(",r.shimArgs.join(","),"){"].join(""));for(var n=[],i=[],o=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],h=[],u=[],f=0;f<r.arrayArgs.length;++f){var c=r.arrayArgs[f];a.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),n.push("t"+c),n.push("r"+c),i.push("t"+c),i.push("r"+c+".join()"),o.push("array"+c+".data"),o.push("array"+c+".stride"),o.push("array"+c+".offset|0"),f>0&&(h.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[f]))),u.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[f])+"]"));}for(r.arrayArgs.length>1&&(t.push("if (!("+h.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),f=0;f<r.scalarArgs.length;++f)o.push("scalar"+r.scalarArgs[f]);return a.push(["type=[",i.join(","),"].join()"].join("")),a.push("proc=CACHED[type]"),t.push("var "+a.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",o.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(e.bind(void 0,r))};},{"./compile.js":4}],6:[function(r,t,a){t.exports=function(r){for(var t=new Array(r),a=0;a<r;++a)t[a]=a;return t};},{}],7:[function(r,t,a){function e(r){return !!r.constructor&&"function"==typeof r.constructor.isBuffer&&r.constructor.isBuffer(r)}t.exports=function(r){return null!=r&&(e(r)||function(r){return "function"==typeof r.readFloatLE&&"function"==typeof r.slice&&e(r.slice(0,0))}(r)||!!r._isBuffer)};},{}],8:[function(r,t,a){function e(r,t){this.corners=r,this.grid=t;}function s(r,t){var a=r[0]-t[0];return a||r[1]-t[1]}var n=r("ndarray"),i=r("uniq"),o=r("ndarray-ops"),h=r("ndarray-prefix-sum"),u=r("contour-2d"),f=r("robust-orientation")[3];t.exports=function(r){for(var t=u(r.transpose(1,0)),a=[],c=0;c<t.length;++c)for(var l=t[c],p=0;p<l.length;++p){var g=l[(p+l.length-1)%l.length],d=l[p],y=l[(p+1)%l.length];if(f(g,d,y)>0){for(var v=[0,0],b=0;b<2;++b)d[b]-g[b]?v[b]=d[b]-g[b]:v[b]=d[b]-y[b],v[b]=d[b]+Math.min(0|Math.round(v[b]/Math.abs(v[b])),0);v[0]>=0&&v[0]<r.shape[0]&&v[1]>=0&&v[1]<r.shape[1]&&0===r.get(v[0],v[1])&&a.push(v);}}i(a,s);var _=n(new Int32Array(r.shape[0]*r.shape[1]),r.shape);return o.gts(_,r,0),h(_),new e(a,_)};var c=e.prototype;c.stabRay=function(r,t,a){return this.stabBox(r,t,a,t)},c.stabTile=function(r,t){return this.stabBox(r,t,r,t)},c.integrate=function(r,t){return r<0||t<0?0:this.grid.get(0|Math.min(r,this.grid.shape[0]-1),0|Math.min(t,this.grid.shape[1]-1))},c.stabBox=function(r,t,a,e){var s=Math.min(r,a),n=Math.min(t,e),i=Math.max(r,a),o=Math.max(t,e);return this.integrate(s-1,n-1)-this.integrate(s-1,o)-this.integrate(i,n-1)+this.integrate(i,o)>0};},{"contour-2d":2,ndarray:14,"ndarray-ops":12,"ndarray-prefix-sum":13,"robust-orientation":15,uniq:21}],9:[function(r,t,a){function e(r,t,a,e){for(var s=+e.x,n=+e.y,i=Math.abs(s-t)+Math.abs(n-a),o=e.landmark,u=0;u<h;++u)i=Math.max(i,r[u]-o[u]);return 1.0000009536743164*i}function s(){this.target=i.create(0,0),this.verts=[],this.freeList=this.target,this.toVisit=o,this.lastS=null,this.lastT=null,this.srcX=0,this.srcY=0,this.dstX=0,this.dstY=0,this.landmarks=[],this.landmarkDist=u.slice();}function n(r,t){var a=r.x-t.x;return a||r.y-t.y}t.exports=s;var i=r("./vertex"),o=i.NIL,h=i.NUM_LANDMARKS,u=i.LANDMARK_DIST,f=s.prototype;f.vertex=function(r,t){var a=i.create(r,t);return this.verts.push(a),a},f.link=function(r,t){i.link(r,t);},f.setSourceAndTarget=function(r,t,a,e){this.srcX=0|r,this.srcY=0|t,this.dstX=0|a,this.dstY=0|e;},f.addS=function(r){0==(2&r.state)&&(r.heuristic=e(this.landmarkDist,this.dstX,this.dstY,r),r.weight=Math.abs(this.srcX-r.x)+Math.abs(this.srcY-r.y)+r.heuristic,r.state|=2,r.pred=null,this.toVisit=i.push(this.toVisit,r),this.freeList=i.insert(this.freeList,r),this.lastS=r);},f.addT=function(r){if(0==(1&r.state)){r.state|=1,this.freeList=i.insert(this.freeList,r),this.lastT=r;for(var t=Math.abs(r.x-this.dstX)+Math.abs(r.y-this.dstY),a=r.landmark,e=this.landmarkDist,s=0;s<h;++s)e[s]=Math.min(e[s],a[s]+t);}},f.getPath=function(r){var t=this.dstX,a=this.dstY;r.push(t,a);for(var e=this.target.pred;e;)t!==e.x&&a!==e.y&&r.push(e.x,a),t===e.x&&a===e.y||r.push(e.x,e.y),t=e.x,a=e.y,e=e.pred;return t!==this.srcX&&a!==this.srcY&&r.push(this.srcX,a),t===this.srcX&&a===this.srcY||r.push(this.srcX,this.srcY),r},f.findComponents=function(){for(var r=this.verts,t=r.length,a=0;a<t;++a)r[a].component=-1;var e=[];for(a=0;a<t;++a){var s=r[a];if(!(s.component>=0)){var n=e.length;s.component=n;for(var i=[s],o=0;o<i.length;)for(var h=i[o++].edges,u=0;u<h.length;++u){var f=h[u];f.component>=0||(f.component=n,i.push(f));}e.push(i);}}return e},f.findLandmarks=function(r){r.sort(n);for(var t=r[r.length>>>1],a=0;a<h;++a){t.weight=0,this.landmarks.push(t);for(var e=t;e!==o;){(t=e).state=2,e=i.pop(e);for(var s=t.weight,u=t.edges,f=0;f<u.length;++f){if(2!==(p=u[f]).state){var c=s+Math.abs(t.x-p.x)+Math.abs(t.y-p.y);0===p.state?(p.state=1,p.weight=c,e=i.push(e,p)):c<p.weight&&(p.weight=c,e=i.decreaseKey(e,p));}}}var l=0;for(f=0;f<r.length;++f){var p;(p=r[f]).state=0,p.landmark[a]=p.weight;for(var g=1/0,d=0;d<=a;++d)g=Math.min(g,p.landmark[d]);g>l&&(t=p,l=g);}}},f.init=function(){for(var r=this.findComponents(),t=0;t<r.length;++t)this.findLandmarks(r[t]);},f.search=function(){var r=this.target,t=this.freeList,a=this.landmarkDist,s=1/0;if(this.lastS&&this.lastT&&this.lastS.component===this.lastT.component){this.srcX,this.srcY;for(var n=+this.dstX,u=+this.dstY,f=this.toVisit;f!==o;){var c=f,l=+c.x,p=+c.y,g=Math.floor(c.weight-c.heuristic);if(3===c.state){s=g+Math.abs(n-l)+Math.abs(u-p),r.pred=c;break}c.state=4,f=i.pop(f);for(var d=c.edges,y=d.length,v=0;v<y;++v){var b=d[v],_=b.state;if(4!==_){var m=g+Math.abs(l-b.x)+Math.abs(p-b.y);if(_<2){var w=e(a,n,u,b);b.state|=2,b.heuristic=w,b.weight=w+m,b.pred=c,f=i.push(f,b),t=i.insert(t,b);}else{var j=m+b.heuristic;j<b.weight&&(b.weight=j,b.pred=c,f=i.decreaseKey(f,b));}}}}}i.clear(t),this.freeList=r,this.toVisit=o,this.lastS=this.lastT=null;for(v=0;v<h;++v)a[v]=1/0;return s};},{"./vertex":11}],10:[function(r,t,a){function e(r,t,a,e,s,n,i){this.y0=r,this.y1=t,this.top=a,this.bottom=e,this.left=s,this.right=n,this.on=i;}function s(r,t,a){this.geometry=r,this.graph=t,this.root=a;}function n(r,t){return r.y0-t}function i(r,t,a,e,s,n){for(var i=0;i<r.length;++i){var o=r[i];t.stabBox(o.x,o.y,s,n)||(e?a.addT(o):a.addS(o));}}function o(r,t,a,e,s,o){for(;a;){if(a.leaf){for(var h=a.verts,f=h.length,c=0;c<f;++c){var l=h[c];r.stabBox(l.x,l.y,s,o)||(e?t.addT(l):t.addS(l));}break}var p=a.buckets,g=u.lt(p,o,n);if(g>=0){var d=p[g];if(o<d.y1)a.x>=s&&i(d.right,r,t,e,s,o),a.x<=s&&i(d.left,r,t,e,s,o),i(d.on,r,t,e,s,o);else{if((l=p[g].bottom)&&!r.stabBox(l.x,l.y,s,o)&&(e?t.addT(l):t.addS(l)),g+1<p.length){(l=p[g+1].top)&&!r.stabBox(l.x,l.y,s,o)&&(e?t.addT(l):t.addS(l));}}}else{(l=p[0].top)&&!r.stabBox(l.x,l.y,s,o)&&(e?t.addT(l):t.addS(l));}if(a.x>s)a=a.left;else{if(!(a.x<s))break;a=a.right;}}}function h(r,t){var a=r[1]-t[1];return a||r[0]-t[0]}var u=r("binary-search-bounds"),f=r("./geometry"),c=r("./graph"),l=64,p=32;t.exports=function(r){function t(r){if(!r)return null;var t=u[r];return t||(u[r]=o.vertex(r[0],r[1]))}function a(r,t){function a(r,a){if(!i.stabTile(t,r)){for(var e=0;e<h.length;++e)if(h[e][0]===t&&h[e][1]===r)return h[e];var s=[t,r];return a?h.unshift(s):h.push(s),u[s]||(u[s]=o.vertex(t,r)),s}return null}function e(r,t){for(var a=0;a<r.length;++a)for(var e=r[a],s=0;s<t.length;++s){var n=t[s];i.stabBox(e[0],e[1],n[0],n[1])||g.push([e,n]);}}for(var s=[],n=[],h=[],f=0;f<r.length;++f)r[f][0]<t?s.push(r[f]):r[f][0]>t?n.push(r[f]):h.push(r[f]);var c=r[0][1],l=r[r.length-1][1],p=a(c,!0),d=a(l,!1);for(e(s,n),e(h,s),e(h,n),f=1;f<h.length;++f){var y=h[f-1],v=h[f];i.stabBox(y[0],y[1],v[0],v[1])||g.push([y,v]);}return {left:s,right:n,on:h,steiner0:p,steiner1:d,y0:c,y1:l}}function n(r,s,f){if(0===r.length)return null;if(r.length<l)return function(r,t,a){for(var e=[],s=0;s<r.length;++s){var n=r[s],h=o.vertex(n[0],n[1]);e.push(h),u[n]=h;for(var f=0;f<s;++f){var c=r[f];i.stabBox(n[0],n[1],c[0],c[1])||g.push([n,c]);}}return new function(r){this.verts=r,this.leaf=!0;}(e)}(r);for(var c=r[r.length>>>1][0],d=function(r,t,a,e){for(var s=[],n=[],i=[],o=0;o<t.length;++o){var u=t[o];a.stabRay(u[0],u[1],r)||i.push(u),u[0]<r?s.push(u):u[0]>r&&n.push(u);}i.sort(h);var f=[],c=[];for(o=0;o<i.length;){for(var l=r,p=r,g=i[o][1];o<i.length&&i[o][1]===g&&i[o][0]<r;)l=i[o++][0];for(l<r&&f.push([l,g]);o<i.length&&i[o][1]===g&&i[o][0]===r;)c.push(i[o]),f.push(i[o]),++o;if(o<i.length&&i[o][1]===g)for(p=i[o++][0];o<i.length&&i[o][1]===g;)++o;p>r&&f.push([p,g]);}return {x:r,left:s,right:n,on:c,vis:f}}(c,r,i),y=n(d.left,s,c),v=n(d.right,c,f),b=0;b<d.on.length;++b)u[d.on[b]]=o.vertex(d.on[b][0],d.on[b][1]);var _=d.vis,m=[],w=null;for(b=0;b<_.length;){for(var j=b,x=Math.min(b+p-1,_.length-1);++x<_.length&&_[x-1][1]===_[x][1];);b=x;var V=a(_.slice(j,x),c);w&&V.steiner0&&!i.stabBox(w[0],w[1],V.steiner0[0],V.steiner0[1])&&g.push([w,V.steiner0]),w=V.steiner1,m.push(new e(V.y0,V.y1,t(V.steiner0),t(V.steiner1),V.left.map(t),V.right.map(t),V.on.map(t)));}return new function(r,t,a,e){this.x=r,this.buckets=t,this.left=a,this.right=e;}(c,m,y,v)}for(var i=f(r),o=new c,u={},g=[],d=n(i.corners,-1/0,1/0),y=0;y<g.length;++y)o.link(u[g[y][0]],u[g[y][1]]);return o.init(),new s(i,o,d)};s.prototype.search=function(r,t,a,e,s){var n=this.geometry;if(r===a&&t===e)return n.stabBox(r,t,a,e)?1/0:(s&&s.push(a,e),0);if(!n.stabBox(r,t,a,e))return s&&(a!==r&&e!==t?s.push(r,t,a,t,a,e):s.push(r,t,a,e)),Math.abs(r-a)+Math.abs(t-e);var i=this.graph;i.setSourceAndTarget(a,e,r,t),o(n,i,this.root,!0,r,t),o(n,i,this.root,!1,a,e);var h=i.search();return s&&h<1/0&&i.getPath(s),h};},{"./geometry":8,"./graph":9,"binary-search-bounds":1}],11:[function(r,t,a){function e(r,t){this.x=r,this.y=t,this.heuristic=.25,this.weight=.25,this.left=null,this.right=null,this.parent=null,this.state=0,this.pred=null,this.nextFree=null,this.edges=[],this.landmark=i.slice(),this.component=0;}function s(r,t){var a=r.left;return t.right=a,a.parent=t,t.parent=r,r.left=t,r.right=o,r}function n(r,t){return r===o?t:t===o?r:r.weight<t.weight?s(r,t):s(t,r)}var i=function(){for(var r=new Array(16),t=0;t<16;++t)r[t]=1/0;return r}(),o=new e(1/0,1/0);o.weight=-1/0,o.left=o.right=o.parent=o,a.create=function(r,t){var a=new e(r,t);return a.left=a.right=a.parent=o,a},a.link=function(r,t){r.edges.push(t),t.edges.push(r);},a.insert=function(r,t){return t.nextFree?r:(t.nextFree=r,t)},a.clear=function(r){for(;r;){var t=r.nextFree;r.state=0,r.left=r.right=r.parent=o,r.nextFree=null,r=t;}},a.NIL=o,a.push=function(r,t){if(r===o)return t;if(r.weight<t.weight){var a=r.left;return t.right=a,a.parent=t,t.parent=r,r.left=t,r}return a=t.left,r.right=a,a.parent=r,r.parent=t,t.left=r,t},a.pop=function(r){var t=r.left;for(r.left=o,r=t;;){var a=r.right;if(a===o)break;t=r;var e=a.right,s=n(t,a);for(r=s;t=e,(a=e.right)!==o;)e=a.right,s=s.right=n(t,a);s.right=o,t!==o&&(t.right=r,r=t);}return r.parent=o,r},a.decreaseKey=function(r,t){var a=t.parent;if(a.weight<t.weight)return r;var e=t.right;if(e.parent=a,a.left===t?a.left=e:a.right=e,r.weight<=t.weight)return (s=r.left).parent=t,t.right=s,r.left=t,t.parent=r,r;var s=t.left;return r.right=s,s.parent=r,t.left=r,r.parent=t,t.right=t.parent=o,t},a.NUM_LANDMARKS=16,a.LANDMARK_DIST=i;},{}],12:[function(r,t,a){function e(r){if(!r)return i;for(var t=0;t<r.args.length;++t){var a=r.args[t];r.args[t]=0===t?{name:a,lvalue:!0,rvalue:!!r.rvalue,count:r.count||1}:{name:a,lvalue:!1,rvalue:!0,count:1};}return r.thisVars||(r.thisVars=[]),r.localVars||(r.localVars=[]),r}function s(r){for(var t=[],a=0;a<r.args.length;++a)t.push("a"+a);return new Function("P",["return function ",r.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(r){return n({args:r.args,pre:e(r.pre),body:e(r.body),post:e(r.proc),funcName:r.funcName})}(r))}var n=r("cwise-compiler"),i={body:"",args:[],thisVars:[],localVars:[]},o={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var r in o){var t=o[r];a[r]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+t+"c"},funcName:r}),a[r+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a"+t+"=b"},rvalue:!0,funcName:r+"eq"}),a[r+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+t+"s"},funcName:r+"s"}),a[r+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a"+t+"=s"},rvalue:!0,funcName:r+"seq"});}}();var h={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var r in h){var t=h[r];a[r]=s({args:["array","array"],body:{args:["a","b"],body:"a="+t+"b"},funcName:r}),a[r+"eq"]=s({args:["array"],body:{args:["a"],body:"a="+t+"a"},rvalue:!0,count:2,funcName:r+"eq"});}}();var u={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var r in u){var t=u[r];a[r]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+t+"c"},funcName:r}),a[r+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+t+"s"},funcName:r+"s"}),a[r+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a=a"+t+"b"},rvalue:!0,count:2,funcName:r+"eq"}),a[r+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+t+"s"},rvalue:!0,count:2,funcName:r+"seq"});}}();var f=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var r=0;r<f.length;++r){var t=f[r];a[t]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:t}),a[t+"eq"]=s({args:["array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"eq"});}}();var c=["max","min","atan2","pow"];!function(){for(var r=0;r<c.length;++r){var t=c[r];a[t]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:t}),a[t+"s"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:t+"s"}),a[t+"eq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"eq"}),a[t+"seq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"seq"});}}();var l=["atan2","pow"];!function(){for(var r=0;r<l.length;++r){var t=l[r];a[t+"op"]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:t+"op"}),a[t+"ops"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:t+"ops"}),a[t+"opeq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"opeq"}),a[t+"opseq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"opseq"});}}(),a.any=n({args:["array"],pre:i,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),a.all=n({args:["array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),a.sum=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),a.prod=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),a.norm2squared=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),a.norm2=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),a.norminf=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),a.norm1=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),a.sup=n({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),a.inf=n({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),a.argmin=n({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),a.argmax=n({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),a.random=s({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),a.assign=s({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),a.assigns=s({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),a.equals=n({args:["array","array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"});},{"cwise-compiler":3}],13:[function(r,t,a){function e(r,t,a){if(0===a){for(var f=[[]],c=0;c<t.length;++c)if(!t[c])for(var l=f.length,p=0;p<l;++p){(d=f[p].slice()).push(i+c),f.push(d);}if(1===f.length)return "";var g=[];"generic"===r?g.push(n,".set(",h,",",n,".get(",h,")+"):g.push(n,"[",h,"]+=");for(c=1;c<f.length;++c){var d,y=((d=f[c]).length+1)%2;c>1&&!y?g.push("+"):y&&g.push("-"),"generic"===r?g.push(n,".get("):g.push(n,"["),g.push(h,"-",d.join("-")),"generic"===r?g.push(")"):g.push("]");}return "generic"===r?g.push(");"):g.push(";"),g.join("")}t[a-1]=!0;var v=[e(r,t,a-1),h,"+=",o,a-1,";for(",u,a-1,"=1;",u,a-1,"<",s,a-1,";++",u,a-1,"){"];return t[a-1]=!1,v.push(e(r,t,a-1),h,"+=",o,a-1,";}"),v.join("")}var s="n",n="d",i="s",o="p",h="o",u="i";t.exports=function(r){var t=r.dtype+r.order.join(),a=f[t];return a||(a=f[t]=function(r,t){for(var a=["prefixSum",t.length,"d",r,"s",t.join("s")].join(""),f=["function ",a,"(arr){var ",n,"=arr.data,",s,"=arr.shape,",i,"=arr.stride,",h,"=arr.offset,"],c=t.length,l=0;l<c;++l)f.push(s,l,"=",s,"[",t[l],"],");for(l=0;l<c;++l)f.push(i,l,"=",i,"[",t[l],"],");for(l=0;l<c;++l)f.push(u,l,"=0,");for(l=c-1;l>0;--l)f.push(o,l,"=",i,l,"-",s,l-1,"*",i,l-1,",");f.push(o,"0=",i,0,";");var p=new Array(c);for(l=0;l<c;++l)p[l]=!0;return f.push(e(r,p,c),"}return ",a),new Function(f.join(""))()}(r.dtype,r.order)),a(r),r};var f={};},{}],14:[function(r,t,a){function e(r,t){return r[0]-t[0]}function s(){var r,t=this.stride,a=new Array(t.length);for(r=0;r<a.length;++r)a[r]=[Math.abs(t[r]),r];a.sort(e);var s=new Array(a.length);for(r=0;r<s.length;++r)s[r]=a[r][1];return s}function n(r,t){var a=["View",t,"d",r].join("");t<0&&(a="View_Nil"+r);var e="generic"===r;if(-1===t){var n="function "+a+"(a){this.data=a;};var proto="+a+".prototype;proto.dtype='"+r+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+a+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+a+"(a){return new "+a+"(a);}";return new Function(n)()}if(0===t){n="function "+a+"(a,d) {this.data = a;this.offset = d};var proto="+a+".prototype;proto.dtype='"+r+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+a+"_copy() {return new "+a+"(this.data,this.offset)};proto.pick=function "+a+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+a+"_get(){return "+(e?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+a+"_set(v){return "+(e?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+a+"(a,b,c,d){return new "+a+"(a,d)}";return new Function("TrivialArray",n)(u[r][0])}n=["'use strict'"];var o=i(t),h=o.map(function(r){return "i"+r}),f="this.offset+"+o.map(function(r){return "this.stride["+r+"]*i"+r}).join("+"),c=o.map(function(r){return "b"+r}).join(","),l=o.map(function(r){return "c"+r}).join(",");n.push("function "+a+"(a,"+c+","+l+",d){this.data=a","this.shape=["+c+"]","this.stride=["+l+"]","this.offset=d|0}","var proto="+a+".prototype","proto.dtype='"+r+"'","proto.dimension="+t),n.push("Object.defineProperty(proto,'size',{get:function "+a+"_size(){return "+o.map(function(r){return "this.shape["+r+"]"}).join("*"),"}})"),1===t?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),t<4?(n.push("function "+a+"_order(){"),2===t?n.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&n.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+a+"_set("+h.join(",")+",v){"),e?n.push("return this.data.set("+f+",v)}"):n.push("return this.data["+f+"]=v}"),n.push("proto.get=function "+a+"_get("+h.join(",")+"){"),e?n.push("return this.data.get("+f+")}"):n.push("return this.data["+f+"]}"),n.push("proto.index=function "+a+"_index(",h.join(),"){return "+f+"}"),n.push("proto.hi=function "+a+"_hi("+h.join(",")+"){return new "+a+"(this.data,"+o.map(function(r){return ["(typeof i",r,"!=='number'||i",r,"<0)?this.shape[",r,"]:i",r,"|0"].join("")}).join(",")+","+o.map(function(r){return "this.stride["+r+"]"}).join(",")+",this.offset)}");var p=o.map(function(r){return "a"+r+"=this.shape["+r+"]"}),g=o.map(function(r){return "c"+r+"=this.stride["+r+"]"});n.push("proto.lo=function "+a+"_lo("+h.join(",")+"){var b=this.offset,d=0,"+p.join(",")+","+g.join(","));for(var d=0;d<t;++d)n.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}");n.push("return new "+a+"(this.data,"+o.map(function(r){return "a"+r}).join(",")+","+o.map(function(r){return "c"+r}).join(",")+",b)}"),n.push("proto.step=function "+a+"_step("+h.join(",")+"){var "+o.map(function(r){return "a"+r+"=this.shape["+r+"]"}).join(",")+","+o.map(function(r){return "b"+r+"=this.stride["+r+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(d=0;d<t;++d)n.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}");n.push("return new "+a+"(this.data,"+o.map(function(r){return "a"+r}).join(",")+","+o.map(function(r){return "b"+r}).join(",")+",c)}");var y=new Array(t),v=new Array(t);for(d=0;d<t;++d)y[d]="a[i"+d+"]",v[d]="b[i"+d+"]";n.push("proto.transpose=function "+a+"_transpose("+h+"){"+h.map(function(r,t){return r+"=("+r+"===undefined?"+t+":"+r+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+a+"(this.data,"+y.join(",")+","+v.join(",")+",this.offset)}"),n.push("proto.pick=function "+a+"_pick("+h+"){var a=[],b=[],c=this.offset");for(d=0;d<t;++d)n.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+a+"(data,shape,stride,offset){return new "+a+"(data,"+o.map(function(r){return "shape["+r+"]"}).join(",")+","+o.map(function(r){return "stride["+r+"]"}).join(",")+",offset)}");return new Function("CTOR_LIST","ORDER",n.join("\n"))(u[r],s)}var i=r("iota-array"),o=r("is-buffer"),h="undefined"!=typeof Float64Array,u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};t.exports=function(r,t,a,e){if(void 0===r)return (0, u.array[0])([]);"number"==typeof r&&(r=[r]),void 0===t&&(t=[r.length]);var s=t.length;if(void 0===a){a=new Array(s);for(var i=s-1,f=1;i>=0;--i)a[i]=f,f*=t[i];}if(void 0===e)for(e=0,i=0;i<s;++i)a[i]<0&&(e-=(t[i]-1)*a[i]);for(var c=function(r){if(o(r))return "buffer";if(h)switch(Object.prototype.toString.call(r)){case"[object Float64Array]":return "float64";case"[object Float32Array]":return "float32";case"[object Int8Array]":return "int8";case"[object Int16Array]":return "int16";case"[object Int32Array]":return "int32";case"[object Uint8Array]":return "uint8";case"[object Uint16Array]":return "uint16";case"[object Uint32Array]":return "uint32";case"[object Uint8ClampedArray]":return "uint8_clamped"}return Array.isArray(r)?"array":"generic"}(r),l=u[c];l.length<=s+1;)l.push(n(c,l.length-1));return (0, l[s+1])(r,t,a,e)};},{"iota-array":6,"is-buffer":7}],15:[function(r,t,a){function e(r,t){for(var a=new Array(r.length-1),e=1;e<r.length;++e)for(var s=a[e-1]=new Array(r.length-1),n=0,i=0;n<r.length;++n)n!==t&&(s[i++]=r[e][n]);return a}function s(r){return 1&r?"-":""}function n(r){if(1===r.length)return r[0];if(2===r.length)return ["sum(",r[0],",",r[1],")"].join("");var t=r.length>>1;return ["sum(",n(r.slice(0,t)),",",n(r.slice(t)),")"].join("")}function i(r){if(2===r.length)return [["sum(prod(",r[0][0],",",r[1][1],"),prod(-",r[0][1],",",r[1][0],"))"].join("")];for(var t=[],a=0;a<r.length;++a)t.push(["scale(",n(i(e(r,a))),",",s(a),r[0][a],")"].join(""));return t}function o(r){for(var t=[],a=[],s=function(r){for(var t=new Array(r),a=0;a<r;++a){t[a]=new Array(r);for(var e=0;e<r;++e)t[a][e]=["m",e,"[",r-a-1,"]"].join("");}return t}(r),o=[],l=0;l<r;++l)0==(1&l)?t.push.apply(t,i(e(s,l))):a.push.apply(a,i(e(s,l))),o.push("m"+l);var p=n(t),g=n(a),d="orientation"+r+"Exact",y=["function ",d,"(",o.join(),"){var p=",p,",n=",g,",d=sub(p,n);return d[d.length-1];};return ",d].join("");return new Function("sum","prod","scale","sub",y)(u,h,f,c)}var h=r("two-product"),u=r("robust-sum"),f=r("robust-scale"),c=r("robust-subtract"),l=5,p=o(3),g=o(4),d=[function(){return 0},function(){return 0},function(r,t){return t[0]-r[0]},function(r,t,a){var e,s=(r[1]-a[1])*(t[0]-a[0]),n=(r[0]-a[0])*(t[1]-a[1]),i=s-n;if(s>0){if(n<=0)return i;e=s+n;}else{if(!(s<0))return i;if(n>=0)return i;e=-(s+n);}var o=3.3306690738754716e-16*e;return i>=o||i<=-o?i:p(r,t,a)},function(r,t,a,e){var s=r[0]-e[0],n=t[0]-e[0],i=a[0]-e[0],o=r[1]-e[1],h=t[1]-e[1],u=a[1]-e[1],f=r[2]-e[2],c=t[2]-e[2],l=a[2]-e[2],p=n*u,d=i*h,y=i*o,v=s*u,b=s*h,_=n*o,m=f*(p-d)+c*(y-v)+l*(b-_),w=7.771561172376103e-16*((Math.abs(p)+Math.abs(d))*Math.abs(f)+(Math.abs(y)+Math.abs(v))*Math.abs(c)+(Math.abs(b)+Math.abs(_))*Math.abs(l));return m>w||-m>w?m:g(r,t,a,e)}];!function(){for(;d.length<=l;)d.push(o(d.length));for(var r=[],a=["slow"],e=0;e<=l;++e)r.push("a"+e),a.push("o"+e);var s=["function getOrientation(",r.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(e=2;e<=l;++e)s.push("case ",e,":return o",e,"(",r.slice(0,e).join(),");");s.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),a.push(s.join(""));var n=Function.apply(void 0,a);for(t.exports=n.apply(void 0,[function(r){var t=d[r.length];return t||(t=d[r.length]=o(r.length)),t.apply(void 0,r)}].concat(d)),e=0;e<=l;++e)t.exports[e]=d[e];}();},{"robust-scale":16,"robust-subtract":17,"robust-sum":18,"two-product":19}],16:[function(r,t,a){var e=r("two-product"),s=r("two-sum");t.exports=function(r,t){var a=r.length;if(1===a){var n=e(r[0],t);return n[0]?n:[n[1]]}var i=new Array(2*a),o=[.1,.1],h=[.1,.1],u=0;e(r[0],t,o),o[0]&&(i[u++]=o[0]);for(var f=1;f<a;++f){e(r[f],t,h);var c=o[1];s(c,h[0],o),o[0]&&(i[u++]=o[0]);var l=h[1],p=o[1],g=l+p,d=p-(g-l);o[1]=g,d&&(i[u++]=d);}return o[1]&&(i[u++]=o[1]),0===u&&(i[u++]=0),i.length=u,i};},{"two-product":19,"two-sum":20}],17:[function(r,t,a){t.exports=function(r,t){var a=0|r.length,e=0|t.length;if(1===a&&1===e)return function(r,t){var a=r+t,e=a-r,s=r-(a-e)+(t-e);return s?[s,a]:[a]}(r[0],-t[0]);var s,n,i=a+e,o=new Array(i),h=0,u=0,f=0,c=Math.abs,l=r[u],p=c(l),g=-t[f],d=c(g);p<d?(n=l,(u+=1)<a&&(p=c(l=r[u]))):(n=g,(f+=1)<e&&(d=c(g=-t[f]))),u<a&&p<d||f>=e?(s=l,(u+=1)<a&&(p=c(l=r[u]))):(s=g,(f+=1)<e&&(d=c(g=-t[f])));for(var y,v,b=s+n,_=b-s,m=n-_,w=m,j=b;u<a&&f<e;)p<d?(s=l,(u+=1)<a&&(p=c(l=r[u]))):(s=g,(f+=1)<e&&(d=c(g=-t[f]))),(m=(n=w)-(_=(b=s+n)-s))&&(o[h++]=m),w=j-((y=j+b)-(v=y-j))+(b-v),j=y;for(;u<a;)(m=(n=w)-(_=(b=(s=l)+n)-s))&&(o[h++]=m),w=j-((y=j+b)-(v=y-j))+(b-v),j=y,(u+=1)<a&&(l=r[u]);for(;f<e;)(m=(n=w)-(_=(b=(s=g)+n)-s))&&(o[h++]=m),w=j-((y=j+b)-(v=y-j))+(b-v),j=y,(f+=1)<e&&(g=-t[f]);return w&&(o[h++]=w),j&&(o[h++]=j),h||(o[h++]=0),o.length=h,o};},{}],18:[function(r,t,a){t.exports=function(r,t){var a=0|r.length,e=0|t.length;if(1===a&&1===e)return function(r,t){var a=r+t,e=a-r,s=r-(a-e)+(t-e);return s?[s,a]:[a]}(r[0],t[0]);var s,n,i=a+e,o=new Array(i),h=0,u=0,f=0,c=Math.abs,l=r[u],p=c(l),g=t[f],d=c(g);p<d?(n=l,(u+=1)<a&&(p=c(l=r[u]))):(n=g,(f+=1)<e&&(d=c(g=t[f]))),u<a&&p<d||f>=e?(s=l,(u+=1)<a&&(p=c(l=r[u]))):(s=g,(f+=1)<e&&(d=c(g=t[f])));for(var y,v,b=s+n,_=b-s,m=n-_,w=m,j=b;u<a&&f<e;)p<d?(s=l,(u+=1)<a&&(p=c(l=r[u]))):(s=g,(f+=1)<e&&(d=c(g=t[f]))),(m=(n=w)-(_=(b=s+n)-s))&&(o[h++]=m),w=j-((y=j+b)-(v=y-j))+(b-v),j=y;for(;u<a;)(m=(n=w)-(_=(b=(s=l)+n)-s))&&(o[h++]=m),w=j-((y=j+b)-(v=y-j))+(b-v),j=y,(u+=1)<a&&(l=r[u]);for(;f<e;)(m=(n=w)-(_=(b=(s=g)+n)-s))&&(o[h++]=m),w=j-((y=j+b)-(v=y-j))+(b-v),j=y,(f+=1)<e&&(g=t[f]);return w&&(o[h++]=w),j&&(o[h++]=j),h||(o[h++]=0),o.length=h,o};},{}],19:[function(r,t,a){t.exports=function(r,t,a){var s=r*t,n=e*r,i=n-(n-r),o=r-i,h=e*t,u=h-(h-t),f=t-u,c=o*f-(s-i*u-o*u-i*f);return a?(a[0]=c,a[1]=s,a):[c,s]};var e=+(Math.pow(2,27)+1);},{}],20:[function(r,t,a){t.exports=function(r,t,a){var e=r+t,s=e-r,n=t-s,i=r-(e-s);return a?(a[0]=i+n,a[1]=e,a):[i+n,e]};},{}],21:[function(r,t,a){t.exports=function(r,t,a){return 0===r.length?r:t?(a||r.sort(t),function(r,t){for(var a=1,e=r.length,s=r[0],n=r[0],i=1;i<e;++i)if(n=s,s=r[i],t(s,n)){if(i===a){a++;continue}r[a++]=s;}return r.length=a,r}(r,t)):(a||r.sort(),function(r){for(var t=1,a=r.length,e=r[0],s=r[0],n=1;n<a;++n,s=e)if(s=e,(e=r[n])!==s){if(n===t){t++;continue}r[t++]=e;}return r.length=t,r}(r))};},{}],22:[function(r,t,a){ndarray=r("ndarray"),createPlanner=r("l1-path-finder");},{"l1-path-finder":10,ndarray:14}]},{},[22]);var ndarray,createPlanner;var pathing = {initializePlanner};

function mind$1(e){var t=e.map,r=e.map.length,u=(e.me.team+1)%2,a="",i=e.getFuelMap(),n=e.getKarboniteMap(),l=(e.getVisibleRobotMap(),e.getVisibleRobotMap()),s=e.map;if(1===e.me.turn){e.castleTalk(e.me.unit),e.buildQueue=[],e.builtDirect=!1,e.pastChurchChain=!1,e.churchAttackLoc=null,e.occupiedHalf=null,e.churchNeedsProtection=!1,e.mapIsHorizontal=search.horizontalSymmetry(t),e.mapIsHorizontal?(e.halfPoint=r/2,e.me.y<r/2?e.lowerHalf=!0:e.lowerHalf=!1):(e.halfPoint=r/2,e.me.x<r/2?e.lowerHalf=!0:e.lowerHalf=!1);for(var c=0;c<r;c++)for(var h=0;h<r;h++)if(!0===i[c][h]&&(e.fuelSpots.push({x:h,y:c}),e.allSpots.push({x:h,y:c,type:"fuel"})),!0===n[c][h]){e.karboniteSpots.push({x:h,y:c}),e.allSpots.push({x:h,y:c,type:"karbonite"});var f=qmath$1.dist(h,c,e.me.x,e.me.y);}var m=99999;for(c=0;c<e.fuelSpots.length;c++)if(!1===ownHalf$1(e,e.fuelSpots[c].x,e.fuelSpots[c].y)){(p=qmath$1.dist(e.fuelSpots[c].x,e.fuelSpots[c].y,e.me.x,e.me.y))<m&&(m=p);}for(c=0;c<e.karboniteSpots.length;c++)if(!1===ownHalf$1(e,e.karboniteSpots[c].x,e.karboniteSpots[c].y)){var p;(p=qmath$1.dist(e.karboniteSpots[c].x,e.karboniteSpots[c].y,e.me.x,e.me.y))<m&&(m=p);}m<=256&&(e.churchNeedsProtection=!0,e.buildQueue=[4]);e.fuelSpots.length;e.maxPilgrims=Math.ceil((e.fuelSpots.length+e.karboniteSpots.length)/2),e.enemyDirection=e.determineEnemyDirection(),e.buildingAttackUnitPositions=[],e.setBuildTowardsEnemyDirections(e);}var S=e.getVisibleRobots();for(c=0;c<S.length;c++){var d=S[c].signal;if(S[c].team===e.me.team)if(d>=33099&&d<=41290&&!1===e.pastChurchChain){var b=33099;d>=37195&&(b=37195);var g=e.getLocation(d-b);base.logStructure(e,g.x,g.y,u,0);var y=g.x,x=g.y;e.mapIsHorizontal?x=r-x-1:y=r-y-1,base.logStructure(e,y,x,e.me.team,0),e.enemyDirection=e.determineEnemyDirection(y,x);var v=!1;e.mapIsHorizontal?x<=r/2&&e.me.y>r/2?(v=!0,e.lowerHalf=!e.lowerHalf):x>=r/2&&e.me.y<r/2&&(v=!0,e.lowerHalf=!e.lowerHalf):y<=r/2&&e.me.x>r/2?(v=!0,e.lowerHalf=!e.lowerHalf):y>=r/2&&e.me.x<r/2&&(v=!0,e.lowerHalf=!e.lowerHalf),!0===v&&(e.churchNeedsProtection=v),37195===b&&(e.status="churchchain",e.churchNeedsProtection=!1,e.churchAttackLoc=[g.x,g.y]);}else 41291===d&&"churchchain"===e.status&&(e.buildQueue=[5],e.signal(41291,4),e.status="spampreachers",e.pastChurchChain=!0);}var H=!1,P=null,k=1e3,C=null,E=!1,w=!1;for(c=0;c<S.length;c++){var R=S[c];if(R.team===u){R.unit===SPECS.CHURCH?E=!0:R.unit===SPECS.CRUSADER?w=!0:R.unit===SPECS.PROPHET&&!0;var T=qmath$1.dist(e.me.x,e.me.y,R.x,R.y);T<k&&(P={x:R.x,y:R.y},k=T,C=R.unit,H=!0);}}if("churchchain"===e.status){b=37195;if(e.karbonite<=500||e.fuel<=6100)b=33099,e.buildQueue=[5],e.signal(41291,4);else{if(null!==e.churchAttackLoc){d=e.compressLocation(e.churchAttackLoc[0],e.churchAttackLoc[1]);e.signal(b+d,4);}e.buildQueue=[2];}}else if("spampreachers"===e.status)if(e.karbonite<30||e.fuel<4e3)e.status="build",e.pastChurchChain=!1;else if(e.buildQueue=[5],null!==P){var L=e.compressLocation(P.x,P.y);b=41292;e.signal(b+L,64);}else e.buildQueue=[4];else e.status="build";if("churchchain"!==e.status&&"spampreachers"!==e.status)if(!1===H){search.unitsInRadius(e,8);var Q=search.unitsInRadius(e,100);if(!0===e.sawEnemyLastTurn&&(e.signal(16391,64),e.buildQueue=[]),e.karbonite>=125&&e.fuel>=60*(Q[SPECS.PROPHET].length+Q[SPECS.PREACHER].length)&&Q[SPECS.PROPHET].length<12&&!0===e.churchNeedsProtection&&(e.buildQueue=[4]),e.sawEnemyLastTurn=!1,e.karbonite>=50&&!1===e.builtDirect){var I=!1,A=null,N=search.circle(e,e.me.x,e.me.y,2);for(c=0;c<N.length;c++){var U=N[c][0],D=N[c][1],O=e.getRobot(l[D][U]);if((!0===i[D][U]||!0===n[D][U])&&null===O){I=!0,A=[U,D];break}}if(null===A&&(e.builtDirect=!0),!0===I&&enoughResourcesToBuild$1(e,2)){e.buildQueue=[];var M=getIndexAllSpots$1(e,A);e.turn>1&&e.castleTalk(77+M);var B=base.rel(e.me.x,e.me.y,A[0],A[1]);if(e.knownStructures[u].length){var z=e.knownStructures[u][0].x,q=e.knownStructures[u][0].y;d=e.compressLocation(z,q),b=33099;e.signal(b+d,2);}return a=e.buildUnit(2,B.dx,B.dy),{action:a}}}}else{var F=search.unitsInRadius(e,36);L=e.compressLocation(P.x,P.y),b=12294;C!==SPECS.PROPHET&&C!==SPECS.PILGRIM&&C!==SPECS.CHURCH||(b=20488),e.signal(b+L,64),e.sawEnemyLastTurn=!0,(E||w)&&F[SPECS.PREACHER].length<1&&e.fuel>=50&&e.karbonite>=30?e.buildQueue.unshift(5):e.buildQueue.unshift(4);}if("build"===e.status||"churchchain"===e.status||"spampreachers"===e.status)if(-1!==e.buildQueue[0]){var K=search.circle(e,e.me.x,e.me.y,2);if(e.buildQueue[0]>2&&"churchchain"!==e.status&&(K=e.buildingAttackUnitPositions),"churchchain"===e.status){var V=K.map(function(t){return {pos:t,dist:qmath$1.dist(t[0],t[1],e.churchAttackLoc[0],e.churchAttackLoc[1])}});V.sort(function(e,t){return e.dist-t.dist}),K=V.map(function(e){return e.pos});}for(c=0;c<K.length;c++){var _=K[c];if(canBuild$1(e,_[0],_[1],l,s)&&e.buildQueue.length>0&&enoughResourcesToBuild$1(e,e.buildQueue[0])){var G=e.buildQueue.shift();B=base.rel(e.me.x,e.me.y,_[0],_[1]);if(e.knownStructures[u].length){z=e.knownStructures[u][0].x,q=e.knownStructures[u][0].y,d=e.compressLocation(z,q),b=33099;"churchchain"!==e.status&&e.signal(b+d,2);}return a=e.buildUnit(G,B.dx,B.dy),{action:a}}}}else e.buildQueue.shift();return {action:a}}function getIndexAllSpots$1(e,t){for(var r=0;r<e.allSpots.length;r++){var u=e.allSpots[r];if(u.x===t[0]&&u.y===t[1])return r}return !1}function canBuild$1(e,t,r,u,a){return !(!search.inArr(t,r,u)||0!==u[r][t]||!0!==a[r][t])}function enoughResourcesToBuild$1(e,t){var r=SPECS.UNITS[t].CONSTRUCTION_FUEL,u=SPECS.UNITS[t].CONSTRUCTION_KARBONITE;return r<=e.fuel&&u<=e.karbonite}function ownHalf$1(e,t,r){var u=e.map,a=u.length;if(e.mapIsHorizontal){if(e.lowerHalf){if(r<u.length/2)return !0}else if(r>=u.length/2)return !0}else if(e.lowerHalf){if(t<a/2)return !0}else if(t>=a/2)return !0;return !1}var church = {mind: mind$1};

function mind$2(e){var t=e.getFuelMap(),n=e.getKarboniteMap(),a=e.getVisibleRobotMap(),i=(e.me.team+1)%2,s="",r=e.map,o=e.map.length,l=null;if(e.globalTurn+=1,1===e.me.turn){e.searchQueue=[],e.lastWarCry=-100,e.miningIndex=-1,e.lastChainTurn=-1,e.statusBeforeReturn="",e.status="searchForKarbDeposit",e.status="waitingForCommand",e.onFrontLine=!1,e.firstTimeScouting=!0,e.frontLineScoutingTarget={x:0,y:0},e.occupiedHalf=null,e.castleTalk(e.me.unit);for(var u=0;u<o;u++)for(var g=0;g<o;g++)!0===t[u][g]&&(e.fuelSpots.push({x:g,y:u}),e.allSpots.push({x:g,y:u,type:"fuel"})),!0===n[u][g]&&(e.karboniteSpots.push({x:g,y:u}),e.allSpots.push({x:g,y:u,type:"karbonite"}));e.churchBuilt=!1,e.searchAny=!1,e.mapIsHorizontal=search.horizontalSymmetry(r);var m=e.initializeCastleLocations();m?(e.originalCastleLocation=[e.knownStructures[e.me.team][0].x,e.knownStructures[e.me.team][0].y],e.globalTurn=m.turn,29002===m.signal&&(e.status="frontLineScout",e.castleTalk(6)),e.globalTurn+=1):(e.status="searchForAnyDeposit",e.churchBuilt=!0,e.searchAny=!0),e.target=[e.me.x,e.me.y],e.finalTarget=[e.me.x,e.me.y],e.mapIsHorizontal?(e.halfPoint=o/2,e.me.y<o/2?e.lowerHalf=!0:e.lowerHalf=!1):(e.halfPoint=o/2,e.me.x<o/2?e.lowerHalf=!0:e.lowerHalf=!1);}5===e.me.turn&&(pathing.initializePlanner(e),e.setFinalTarget(e.finalTarget));var f=e.getVisibleRobots();for(u=0;u<f.length;u++)if(f[u].team===e.me.team){var c=f[u].signal,p=f[u].id;if(signal.processMessagePilgrim(e,c),c>=24586&&c<=28681&&"frontLineScout"!==e.status){e.status="goingToDeposit";var S=24586,h=e.getLocation(c-S);e.finalTarget=[h.x,h.y],e.miningIndex=getIndexAllSpots$2(e,e.finalTarget);var d=search.circle(e,e.finalTarget[0],e.finalTarget[1],2),x=0,T=null;for(u=0;u<d.length;u++){var y=d[u],C=e.getRobot(a[y[1]][y[0]]),b=numberOfDeposits$1(e,y[0],y[1],!0);null===C&&!1===t[y[1]][y[0]]&&!1===n[y[1]][y[0]]&&!0===r[y[1]][y[0]]&&x<b&&(x=b,T=y),9===b&&(T=y,x=b);}null!==T&&(e.status="building",e.buildTarget=T);}else if(c<28842&&c>=28682&&"waitingForCommand"===e.status&&-1===e.miningIndex&&"frontLineScout"!==e.status){var E=c-(S=28682);e.status="goingToDeposit",e.miningIndex=E,e.finalTarget=[e.allSpots[e.miningIndex].x,e.allSpots[e.miningIndex].y];}else if(c<29002&&c>=28842&&"waitingForCommand"===e.status&&"frontLineScout"!==e.status){E=c-(S=28842);e.status="goingToDeposit";var P=e.allSpots[e.miningIndex];P.type===e.allSpots[E].type&&0===qmath$1.dist(P.x,P.y,e.me.x,e.me.y)||(e.miningIndex=E),e.finalTarget=[e.allSpots[e.miningIndex].x,e.allSpots[e.miningIndex].y];}else if(c>=33099&&c<=41290){S=33099;c>=37195&&(S=37195);var H=e.getLocation(c-S);base.logStructure(e,H.x,H.y,i,0);var I=H.x,R=H.y;if(e.mapIsHorizontal?R=o-R-1:I=o-I-1,base.logStructure(e,I,R,e.me.team,0),e.enemyDirection=e.determineEnemyDirection(I,R),e.mapIsHorizontal?R<=o/2&&e.me.y>o/2?e.lowerHalf=!e.lowerHalf:R>=o/2&&e.me.y<o/2&&(e.lowerHalf=!e.lowerHalf):I<=o/2&&e.me.x>o/2?e.lowerHalf=!e.lowerHalf:I>=o/2&&e.me.x<o/2&&(e.lowerHalf=!e.lowerHalf),37195===S&&("frontLineScout"!==e.status&&(e.status="chainedPilgrim"),e.karbonite>400&&e.fuel>6100&&e.knownStructures[i].length)){var D=e.knownStructures[i][0].x,v=e.knownStructures[i][0].y,k=e.compressLocation(D,v),A=37195;(B=(M=search.circle(e,e.me.x,e.me.y,2)).map(function(e){return {pos:e,dist:qmath$1.dist(e[0],e[1],D,v)}})).sort(function(e,t){return e.dist-t.dist}),M=B.map(function(e){return e.pos});for(u=0;u<M.length;u++){if(canBuild$2(e,(z=M[u])[0],z[1],a,r)){var F=base.rel(e.me.x,e.me.y,z[0],z[1]);return e.signal(A+k,4),{action:e.buildUnit(SPECS.CHURCH,F.dx,F.dy)}}}}}else 41291===c&&p!==e.me.id&&("chainedPilgrim"===e.status&&(e.signal(41291,4),e.status="searchForAnyDeposit"),e.status);}if("waitingForCommand"===e.status?(e.status="goingToDeposit",1!==e.me.turn&&(e.finalTarget=[e.allSpots[e.miningIndex].x,e.allSpots[e.miningIndex].y]),e.status="searchForAnyDeposit"):"frontLineScout"===e.status&&e.firstTimeScouting&&(e.frontLineScoutingTarget=[e.knownStructures[i][0].x,e.knownStructures[i][0].y],e.finalTarget=e.frontLineScoutingTarget),"moveaway"===e.status)for(var w=search.circle(e,e.me.x,e.me.y,2),L=0;L<w.length;L++)w[L];"frontLineScout"===e.status&&e.me.turn>1&&(!0===e.onFrontLine?e.me.turn%3==0?e.castleTalk(71+e.me.y):e.me.turn%3==1?e.castleTalk(7+e.me.x):e.castleTalk(135):e.me.turn%2==0?e.castleTalk(71+e.me.y):e.castleTalk(7+e.me.x));var Q=search.unitsInRadius(e,64);"frontLineScout"===e.status&&Q[SPECS.PREACHER].length+Q[SPECS.CRUSADER].length>10&&e.me.turn-e.lastWarCry>10&&(e.lastWarCry=e.me.turn);var U=[];e.onFrontLine=!1;for(u=0;u<f.length;u++){var q=f[u];if(q.team===i){var K=qmath$1.dist(e.me.x,e.me.y,q.x,q.y);if((K>64&&q.unit!==SPECS.PREACHER||K>=36&&q.unit===SPECS.PREACHER)&&K<=100&&q.unit!==SPECS.PILGRIM)if(e.onFrontLine=!0,"frontLineScout"===e.status){if(e.finalTarget=[e.me.x,e.me.y],!0===e.onFrontLine&&e.knownStructures[i].length){D=e.knownStructures[i][0].x,v=e.knownStructures[i][0].y,k=e.compressLocation(D,v),A=37195;if(e.karbonite>=800&&e.fuel>=1e4&&e.lastChainTurn<e.me.turn-2&&Q[SPECS.PROPHET].length>6){var M,B;(B=(M=search.circle(e,e.me.x,e.me.y,2)).map(function(e){return {pos:e,dist:qmath$1.dist(e[0],e[1],D,v)}})).sort(function(e,t){return e.dist-t.dist}),M=B.map(function(e){return e.pos});for(u=0;u<M.length;u++){var z;if(null!==(C=a[(z=M[u])[1]][z[0]])&&C.unit===SPECS.CHURCH&&C.team===e.me.team){e.signal(A+k,4);break}if(canBuild$2(e,z[0],z[1],a,r)){F=base.rel(e.me.x,e.me.y,z[0],z[1]);return e.signal(A+k,4),e.lastChainTurn=e.me.turn,{action:e.buildUnit(SPECS.CHURCH,F.dx,F.dy)}}}}}}else l="";else e.status,q.unit===SPECS.PROPHET&&K<100?U.push([q.x,q.y,SPECS.PROPHET]):q.unit===SPECS.PREACHER&&K<=64?U.push([q.x,q.y,SPECS.PREACHER]):q.unit===SPECS.CRUSADER&&K<=64?U.push([q.x,q.y,SPECS.CRUSADER]):q.unit===SPECS.CHURCH&&K<80?U.push([q.x,q.y,SPECS.CHURCH]):q.unit===SPECS.CASTLE&&K<100&&U.push([q.x,q.y,SPECS.CASTLE]);}}var O=[];if(U.length>0){var V=search.circle(e,e.me.x,e.me.y,4);for(u=0;u<V.length;u++){var G=0;y=V[u];if(search.emptyPos(y[0],y[1],a,e.map)){for(g=0;g<U.length;g++)G+=qmath$1.dist(y[0],y[1],U[g][0],U[g][1]);O.push({pos:y,dist:G});}}}if(O.length>0){O.sort(function(e,t){return t.dist-e.dist});F=base.rel(e.me.x,e.me.y,O[0].pos[0],O[0].pos[1]);"frontLineScout"!==e.status&&(e.status="searchForAnyDeposit");var N=!1;for(u=0;u<U.length;u++){var W=qmath$1.dist(O[0].pos[0],O[0].pos[1],U[u][0],U[u][1]);U[u][2]!==SPECS.PILGRIM&&(U[u][2]===SPECS.PREACHER?W<=36&&(N=!0):W<=64&&(N=!0));}if(!N)return {action:e.move(F.dx,F.dy)};l="";}if("goingToKarbDeposit"===e.status||"goingToFuelDeposit"===e.status||"goingToAnyDeposit"===e.status)if(a[e.finalTarget[1]][e.finalTarget[0]]!==e.me.id&&a[e.finalTarget[1]][e.finalTarget[0]]>0){if("goingToKarbDeposit"===e.status)if(e.miningIndex=getIndexAllSpots$2(e,e.finalTarget),e.castleTalk(e.miningIndex+77),0===e.searchQueue.length)e.status="searchForAnyDeposit";else{var j=e.searchQueue.pop().position;e.finalTarget=j,e.miningIndex=getIndexAllSpots$2(e,e.finalTarget),e.castleTalk(e.miningIndex+77);}else if("goingToFuelDeposit"===e.status)if(e.miningIndex=getIndexAllSpots$2(e,e.finalTarget),e.castleTalk(e.miningIndex+77),0===e.searchQueue.length)e.status="searchForAnyDeposit";else{j=e.searchQueue.pop().position;e.finalTarget=j,e.miningIndex=getIndexAllSpots$2(e,e.finalTarget),e.castleTalk(e.miningIndex+77);}else if(!0===e.churchBuilt||!0===e.searchAny||"goingToAnyDeposit"===e.status)if(0===e.searchQueue.length)e.status="searchForAnyDeposit";else{j=e.searchQueue.pop().position;e.finalTarget=j,e.miningIndex=getIndexAllSpots$2(e,e.finalTarget),e.castleTalk(e.miningIndex+77);}}else e.miningIndex=getIndexAllSpots$2(e,e.finalTarget),e.castleTalk(e.miningIndex+77);if("goingToDeposit"===e.status&&a[e.finalTarget[1]][e.finalTarget[0]]!==e.me.id&&a[e.finalTarget[1]][e.finalTarget[0]]>0&&qmath$1.dist(e.me.x,e.me.y,e.finalTarget[0],e.finalTarget[1])<=2&&(e.status="searchForAnyDeposit"),"searchForKarbDeposit"===e.status||"searchForFuelDeposit"===e.status){if("searchForFuelDeposit"===e.status){for(u=0;u<e.fuelSpots.length;u++){D=e.fuelSpots[u].x;if((a[v=e.fuelSpots[u].y][D]<=0||a[v][D]===e.me.id)&&safeDeposit$1(e,D,v)){var J=[],X=0;X=null!==e.planner?e.planner.search(e.me.y,e.me.x,v,D,J):qmath$1.dist(e.me.x,e.me.y,D,v),e.searchQueue.push({position:[D,v],distance:X});}}e.searchQueue.sort(function(e,t){return t.distance-e.distance}),e.searchQueue.length>0&&(e.status="goingToFuelDeposit",e.finalTarget=e.searchQueue.pop().position);}if("searchForKarbDeposit"===e.status){e.searchQueue=[];for(u=0;u<e.karboniteSpots.length;u++){D=e.karboniteSpots[u].x;if((a[v=e.karboniteSpots[u].y][D]<=0||a[v][D]===e.me.id)&&safeDeposit$1(e,D,v)){J=[],X=0;X=null!==e.planner?e.planner.search(e.me.y,e.me.x,v,D,J):qmath$1.dist(e.me.x,e.me.y,D,v),e.searchQueue.push({position:[D,v],distance:X});}}e.searchQueue.sort(function(e,t){return t.distance-e.distance}),e.searchQueue.length>0&&(e.status="goingToKarbDeposit",e.finalTarget=e.searchQueue.pop().position);}}if("searchForAnyDeposit"===e.status){e.searchQueue=[];for(u=0;u<e.fuelSpots.length;u++){D=e.fuelSpots[u].x;if((a[v=e.fuelSpots[u].y][D]<=0||a[v][D]===e.me.id)&&safeDeposit$1(e,D,v)){J=[],X=0;X=null!==e.planner?e.planner.search(e.me.y,e.me.x,v,D,J):qmath$1.dist(e.me.x,e.me.y,D,v),e.searchQueue.push({position:[D,v],distance:X});}}for(u=0;u<e.karboniteSpots.length;u++){D=e.karboniteSpots[u].x;if((a[v=e.karboniteSpots[u].y][D]<=0||a[v][D]===e.me.id)&&safeDeposit$1(e,D,v)){J=[],X=0;X=null!==e.planner?e.planner.search(e.me.y,e.me.x,v,D,J):qmath$1.dist(e.me.x,e.me.y,D,v),e.searchQueue.push({position:[D,v],distance:X});}}e.searchQueue.sort(function(e,t){return t.distance-e.distance}),e.searchQueue.length>0&&(e.finalTarget=e.searchQueue.pop().position,e.status="goingToAnyDeposit",e.miningIndex=getIndexAllSpots$2(e,e.finalTarget));}if(e.me.fuel>=100||e.me.karbonite>=20||"return"===e.status){var Y=search.findNearestStructure(e),Z=!0;if("building"===e.status&&qmath$1.dist(Y.x,Y.y,e.me.x,e.me.y)>100&&(Z=!1),Z){"mineKarb"!==e.status&&"mineFuel"!==e.status||(e.statusBeforeReturn=e.status),"mineKarb"===e.statusBeforeReturn||e.statusBeforeReturn,e.finalTarget=[Y.x,Y.y],e.status="return";var $=base.rel(e.me.x,e.me.y,e.finalTarget[0],e.finalTarget[1]);if(Math.abs($.dx)<=1&&Math.abs($.dy)<=1)return Y.unit===SPECS.CASTLE?(e.status="waitingForCommand",e.signal(4,2),e.castleTalk(0)):Y.unit===SPECS.CHURCH&&(e.status="goingToDeposit",e.finalTarget=[e.allSpots[e.miningIndex].x,e.allSpots[e.miningIndex].y]),s=e.give($.dx,$.dy,e.me.karbonite,e.me.fuel),{action:s}}}if("goingToDeposit"===e.status){d=search.circle(e,e.finalTarget[0],e.finalTarget[1],2);var _=!1;e.me.turn>1&&e.castleTalk(e.miningIndex+77);for(u=0;u<d.length;u++){y=d[u];(null===(C=e.getRobot(a[y[1]][y[0]]))||C.unit===SPECS.CHURCH&&C.unit===SPECS.CASTLE)&&null!==C||(_=!0);}1==_&&e.me.turn;}if("mineKarb"===e.status||"mineFuel"===e.status){d=search.circle(e,e.me.x,e.me.y,2);var ee=search.findNearestStructure(e),te=qmath$1.dist(e.me.x,e.me.y,ee.x,ee.y),ne=4;if(e.globalTurn<=50&&(ne=10),te>ne){for(_=!0,u=0;u<d.length;u++){y=d[u];null===(C=e.getRobot(a[y[1]][y[0]]))||C.unit!==SPECS.CHURCH&&C.unit!==SPECS.CASTLE||(_=!1);}if(!0===_){for(x=0,T=null,u=0;u<d.length;u++){y=d[u],C=e.getRobot(a[y[1]][y[0]]),b=numberOfDeposits$1(e,y[0],y[1],!0);null===C&&!1===t[y[1]][y[0]]&&!1===n[y[1]][y[0]]&&!0===r[y[1]][y[0]]&&x<b&&(x=b,T=y),9===b&&(T=y,x=b);}null!==T&&(e.status="building",e.buildTarget=T,e.finalTarget=[e.me.x,e.me.y]);}}}if("building"===e.status){e.me.turn>1&&e.castleTalk(e.miningIndex+77);if(null!==(C=e.getRobot(a[e.buildTarget[1]][e.buildTarget[0]]))&&C.unit===SPECS.CHURCH)e.status="goingToDeposit";else{if(e.me.x!==e.finalTarget[0]||e.me.y!==e.finalTarget[1])return s=e.navigate(e.finalTarget),{action:s};F=base.rel(e.me.x,e.me.y,e.buildTarget[0],e.buildTarget[1]);if(e.fuel+e.me.fuel>=300&&e.karbonite+e.me.karbonite>=75){if(e.status="goingToDeposit",e.knownStructures[i].length){D=e.knownStructures[i][0].x,v=e.knownStructures[i][0].y,c=e.compressLocation(D,v),S=33099;e.signal(S+c,2);}return {action:e.buildUnit(SPECS.CHURCH,F.dx,F.dy)}}var ae=e.getRobot(a[e.finalTarget[1]][e.finalTarget[0]]);null!==ae&&ae.team===e.me.team&&ae.unit===SPECS.PILGRIM&&e.me.id!==ae.id&&(e.status="goingToDeposit");}}return "goingToDeposit"===e.status&&0===qmath$1.dist(e.me.x,e.me.y,e.finalTarget[0],e.finalTarget[1])&&(e.status="mineHere"),!0!==n[e.me.y][e.me.x]||"mineHere"!==e.status&&"goingToKarbDeposit"!==e.status&&"mineKarb"!==e.status&&"building"!==e.status&&"goingToAnyDeposit"!==e.status?!0!==t[e.me.y][e.me.x]||"mineHere"!==e.status&&"goingToFuelDeposit"!==e.status&&"mineFuel"!==e.status&&"goingToAnyDeposit"!==e.status&&"building"!==e.status?null!==l?{action:l}:(s=e.navigate(e.finalTarget),{action:s}):(s=e.mine(),e.miningIndex=getIndexAllSpots$2(e,[e.me.x,e.me.y]),"building"!==e.status&&(e.status="mineFuel",e.me.turn>1&&e.castleTalk(e.miningIndex+77)),{action:s}):(s=e.mine(),e.miningIndex=getIndexAllSpots$2(e,[e.me.x,e.me.y]),"building"!==e.status&&(e.status="mineKarb",e.me.turn>1&&e.castleTalk(e.miningIndex+77)),{action:s})}function numberOfDeposits$1(e,t,n,a=false){for(var i=search.circle(e,t,n,2),s=0,r=e.getVisibleRobotMap(),o=e.getFuelMap(),l=e.getKarboniteMap(),u=0;u<i.length;u++){var g=i[u][0],m=i[u][1];if(!0===o[m][g]||!0===l[m][g])if(!1===a)s+=1;else{for(var f=search.circle(e,g,m,2),c=!0,p=0;p<f.length;p++){var S=f[p][0],h=f[p][1],d=e.getRobot(r[h][S]);null===d||d.team!==e.me.team||d.unit!==SPECS.CASTLE&&d.unit!==SPECS.CHURCH||(c=!1);}!0===c&&(s+=1);}}return s}function safeDeposit$1(e,t,n){if(ownHalf$2(e,t,n))return !0;e.getVisibleRobotMap();var a=search.unitsInRadius(e,64,e.me.team,t,n);if(a[SPECS.PROPHET].length+a[SPECS.PREACHER].length>=1)return !0;var i=search.findNearestStructure(e);return qmath$1.dist(t,n,i.x,i.y)<=9}function ownHalf$2(e,t,n){var a=e.map,i=a.length;if(e.mapIsHorizontal){if(e.lowerHalf){if(n<i/2)return !0}else if(n>=i/2)return !0}else if(e.lowerHalf){if(t<a[0].length/2)return !0}else if(t>=a[0].length/2)return !0;return !1}function canBuild$2(e,t,n,a,i){return !(!search.inArr(t,n,a)||0!==a[n][t]||!0!==i[n][t])}function getIndexAllSpots$2(e,t){for(var n=0;n<e.allSpots.length;n++){var a=e.allSpots[n];if(a.x===t[0]&&a.y===t[1])return n}return !1}var pilgrim = {mind: mind$2};

function mind$3(t){var e=t.map,a=(t.me.team+1)%2,s="",r=t.getVisibleRobotMap(),n=t.getFuelMap(),i=e.length,l=t.getKarboniteMap();if(1===t.me.turn){t.castleTalk(t.me.unit),t.mapIsHorizontal=search.horizontalSymmetry(e),t.useRallyTargetToMakeLattice=!0,t.defendLocChosen=!1;if(t.initializeCastleLocations()){var o=t.knownStructures[a][0];t.status="defend",t.oldStatus="defend";var u=base.relToPos(t.me.x,t.me.y,o[0],o[1],t);t.finalTarget=[t.me.x+u.dx,t.me.y+u.dy],t.defendTarget=[t.me.x,t.me.y];}else t.status="defend",t.oldStatus="defend",t.defendTarget=[t.me.x,t.me.y],t.finalTarget=[t.me.x,t.me.y];t.origStructureLoc=[t.me.x,t.me.y];for(var d=search.circle(t,t.me.x,t.me.y,2),f=0;f<d.length;f++){var g=d[f],m=r[g[1]][g[0]];if(null!==(A=t.getRobot(m))&&A.team===t.me.team&&(A.unit===SPECS.CASTLE||A.unit===SPECS.CHURCH)){t.origStructureLoc=g;break}}t.enemyDirection=t.determineEnemyDirection();}5===t.me.turn&&(pathing.initializePlanner(t),t.setFinalTarget(t.finalTarget));var c=t.getVisibleRobots(),y={0:[],1:[],2:[],3:[],4:[],5:[],6:[]};for(f=0;f<c.length;f++){var T=c[f].signal;if(signal.processMessageCrusader(t,T),c[f].team===t.me.team){if(T>=12294&&T<=16389){"attackTarget"!==t.status&&(t.oldStatus=t.status),t.status="attackTarget";var S=12294,x=t.getLocation(T-S);t.finalTarget=[x.x,x.y];}if(T>=16392&&T<=20487){"goToTarget"!==t.status&&(t.oldStatus=t.status),t.status="goToTarget";S=16392,x=t.getLocation(T-S);t.finalTarget=[x.x,x.y];}if(T>=20488&&T<=24583){"goToTarget"!==t.status&&(t.oldStatus=t.status),t.status="goToTarget";S=20488,x=t.getLocation(T-S);t.finalTarget=[x.x,x.y],base.logStructure(t,t.finalTarget[0],t.finalTarget[1],a,0);}else if(T>=29003&&T<=33098&&"rally"!==t.status){"rally"!==t.status&&(t.oldStatus=t.status),t.status="rally";S=29003,x=t.getLocation(T-S);t.finalTarget=[x.x,x.y],t.rallyTarget=t.finalTarget;}else if(T>=33099&&T<=37194){S=33099;var L=t.getLocation(T-S);base.logStructure(t,L.x,L.y,a,0);var h=L.x,k=L.y;t.mapIsHorizontal?k=i-k-1:h=i-h-1,base.logStructure(t,h,k,t.me.team,0),t.enemyDirection=t.determineEnemyDirection(h,k);}}else if(T>=41292&&T<=45387){"attackTarget"!==t.status&&(t.oldStatus=t.status),t.status="attackTarget";S=41292,x=t.getLocation(T-S);t.finalTarget=[x.x,x.y];}c[f].unit===SPECS.CHURCH&&y[6].push(c[f]);}if("searchAndAttack"===t.status&&(32),base.updateKnownStructures(t),"rally"!==t.status&&(t.useRallyTargetToMakeLattice=!0),"defend"===t.status||"defendOldPos"===t.status||"defendSpot"===t.status||"rally"===t.status){var C=search.findNearestStructure(t),v=qmath$1.dist(t.me.x,t.me.y,C.x,C.y);if(r[t.finalTarget[1]][t.finalTarget[0]]>0&&r[t.finalTarget[1]][t.finalTarget[0]]!==t.me.id&&(t.defendLocChosen=!1),t.me.x%2==1&&t.me.y%2==1||t.me.x%2==0&&t.me.y%2==0||!0===n[t.me.y][t.me.x]||!0===l[t.me.y][t.me.x]||v<=2||"defendOldPos"===t.status){var D=null;!1===t.defendLocChosen&&("left"===t.enemyDirection?D="rally"===t.status?t.findDefendLoc(t,y,t.rallyTarget[0],i,0,i):t.findDefendLoc(t,y,0,t.defendTarget[0],0,i):"right"===t.enemyDirection?D="rally"===t.status?t.findDefendLoc(t,y,0,t.rallyTarget[0],0,i):t.findDefendLoc(t,y,t.defendTarget[0],i,0,i):"up"===t.enemyDirection?D="rally"===t.status?t.findDefendLoc(t,y,0,i,t.rallyTarget[1],i):t.findDefendLoc(t,y,0,i,0,t.defendTarget[1]):"down"===t.enemyDirection&&(D="rally"===t.status?t.findDefendLoc(t,y,0,i,0,t.rallyTarget[1]):t.findDefendLoc(t,y,0,i,t.defendTarget[1],i)),t.defendLocChosen=!0),null!==D&&(t.finalTarget=D),"defendOldPos"===t.status&&(t.status="defend");}}if("searchAndAttack"===t.status&&(t.knownStructures[a].length?t.finalTarget=[t.knownStructures[a][0].x,t.knownStructures[a][0].y]:t.status="defend"),"searchAndAttack"===t.status||"rally"===t.status||"defend"===t.status||"attackTarget"===t.status||"goToTarget"===t.status||"rally"===t.status){var b=99999999,p=!1,P=null;for(f=0;f<c.length;f++){var A;if((A=c[f]).team!==t.me.team){A.unit===SPECS.CASTLE||(A.unit,SPECS.CHURCH);var E=qmath$1.dist(t.me.x,t.me.y,A.x,A.y);E<b&&(b=E,p=!0,P=A);}}if(null!==P&&"goToTarget"===t.status&&(t.finalTarget=[P.x,P.y]),b<=16&&!0===p){u=base.rel(t.me.x,t.me.y,P.x,P.y);if(t.readyAttack())return s=t.attack(u.dx,u.dy),{action:s}}if(!0===t.destroyedCastle){t.destroyedCastle=!1;t.knownStructures[t.me.team][0].x,t.knownStructures[t.me.team][0].y;t.status="defend";}}if("attackTarget"===t.status)qmath$1.dist(t.me.x,t.me.y,t.finalTarget[0],t.finalTarget[1]);t.status;var w=!0;return "rally"===t.status&&(w=!1),s=t.navigate(t.finalTarget,!1,w),{action:s}}var crusader = {mind: mind$3};

function mind$4(e){var t=e.map,a=e.map.length,n=(e.me.team+1)%2,s="",r=e.getVisibleRobotMap(),i=e.getFuelMap(),l=e.getKarboniteMap();if(1===e.me.turn){e.defendLocChosen=!1,e.useRallyTargetToMakeLattice=!0,e.castleTalk(e.me.unit),e.mapIsHorizontal=search.horizontalSymmetry(t),e.initializeCastleLocations(),e.finalTarget=[e.me.x,e.me.y],e.status="defend",e.rallyTarget=[e.me.x,e.me.y],e.defendTarget=[e.me.x,e.me.y],e.moveSpeed="fast",e.origStructureLoc=[e.me.x,e.me.y];for(var o=search.circle(e,e.me.x,e.me.y,2),d=0;d<o.length;d++){var f=r[(K=o[d])[1]][K[0]];if(null!==(j=e.getRobot(f))&&j.team===e.me.team&&(j.unit===SPECS.CASTLE||j.unit===SPECS.CHURCH)){e.origStructureLoc=K;break}}for(d=0;d<a;d++)for(var u=0;u<a;u++)!0===i[d][u]&&(e.fuelSpots.push({x:u,y:d}),e.allSpots.push({x:u,y:d,type:"fuel"})),!0===l[d][u]&&(e.karboniteSpots.push({x:u,y:d}),e.allSpots.push({x:u,y:d,type:"karbonite"}));e.enemyDirection=e.determineEnemyDirection();}5===e.me.turn&&pathing.initializePlanner(e);var m=e.getVisibleRobots(),g=99999,y={0:[],1:[],2:[],3:[],4:[],5:[],6:[]};for(d=0;d<m.length;d++){var c=m[d].signal;if(m[d].team===e.me.team){if(signal.processMessageProphet(e,c),c>=12294&&c<=24583){if(c>=12294&&c<=16389)var S=12294,T=e.getLocation(c-S);if(c>=16392&&c<=20487){e.status="attackTarget";S=16392,T=e.getLocation(c-S);e.finalTarget=[T.x,T.y];}if(c>=20488&&c<=24583){e.status="goToTarget";S=20488,T=e.getLocation(c-S);e.finalTarget=[T.x,T.y],base.logStructure(e,e.finalTarget[0],e.finalTarget[1],n,0);}}if(c>=24586&&c<=28681){e.status="defendSpot";S=24586,T=e.getLocation(c-S);e.defendTarget=[T.x,T.y],e.finalTarget=[T.x,T.y];}else if(c>=29003&&c<=33098&&"rally"!==e.status){"rally"!==e.status&&(e.oldStatus=e.status),e.status="rally";S=29003,T=e.getLocation(c-S);e.finalTarget=[T.x,T.y],e.rallyTarget=e.finalTarget;}else if(c>=33099&&c<=37194){S=33099;var x=e.getLocation(c-S);base.logStructure(e,x.x,x.y,n,0);var p=x.x,h=x.y;e.mapIsHorizontal?h=a-h-1:p=a-p-1,base.logStructure(e,p,h,e.me.team,0),e.enemyDirection=e.determineEnemyDirection(p,h);}else if(c>=41292&&c<=45387&&"rally"!==e.status){e.status="attackTarget";S=41292,T=e.getLocation(c-S);e.finalTarget=[T.x,T.y];}}if(m[d].unit===SPECS.PREACHER&&m[d].team===n){(w=qmath$1.dist(e.me.x,e.me.y,m[d].x,m[d].y))<g&&(g=w,m[d]);}else m[d].unit===SPECS.CHURCH&&y[6].push(m[d]);}if(e.me.turn>1){var v=99999,C=null;for(d=0;d<e.allSpots.length;d++){var L=e.allSpots[d],P=r[L.y][L.x],E=e.getRobot(r[L.y][L.x]);if(0===P||null!==E&&E.team===e.me.team&&E.unit!==SPECS.PILGRIM){var k=qmath$1.dist(e.me.x,e.me.y,L.x,L.y);k<v&&(v=k,C=L);}}if(null!==C){var R=getIndexAllSpots$3(e,[C.x,C.y]);e.castleTalk(R+77);}}if(base.updateKnownStructures(e),"rally"!==e.status&&(e.useRallyTargetToMakeLattice=!0),"defend"===e.status||"defendOldPos"===e.status||"defendSpot"===e.status||"rally"===e.status||"defend2nd"===e.status){var D=search.findNearestStructure(e),b=qmath$1.dist(e.me.x,e.me.y,D.x,D.y);if(r[e.finalTarget[1]][e.finalTarget[0]]>0&&r[e.finalTarget[1]][e.finalTarget[0]]!==e.me.id&&(e.defendLocChosen=!1),e.me.x%2==1&&e.me.y%2==1||e.me.x%2==0&&e.me.y%2==0||!0===i[e.me.y][e.me.x]||!0===l[e.me.y][e.me.x]||b<=2||"defendOldPos"===e.status){var A=null;!1===e.defendLocChosen&&("left"===e.enemyDirection?A="rally"===e.status?e.findDefendLoc(e,y,e.rallyTarget[0],a,0,a):e.findDefendLoc(e,y,0,e.defendTarget[0],0,a):"right"===e.enemyDirection?A="rally"===e.status?e.findDefendLoc(e,y,0,e.rallyTarget[0],0,a):e.findDefendLoc(e,y,e.defendTarget[0],a,0,a):"up"===e.enemyDirection?A="rally"===e.status?e.findDefendLoc(e,y,0,a,e.rallyTarget[1],a):e.findDefendLoc(e,y,0,a,0,e.defendTarget[1]):"down"===e.enemyDirection&&(A="rally"===e.status?e.findDefendLoc(e,y,0,a,0,e.rallyTarget[1]):e.findDefendLoc(e,y,0,a,e.defendTarget[1],a)),e.defendLocChosen=!0),null!==A&&(e.finalTarget=A),"defendOldPos"===e.status&&(e.status="defend");}}if("searchAndAttack"===e.status&&(e.knownStructures[n].length?e.finalTarget=[e.knownStructures[n][0].x,e.knownStructures[n][0].y]:e.status="defend2nd"),"defend"===e.status||"attackTarget"===e.status||"defendSpot"===e.status||"defend2nd"===e.status){var H=[],q=0;for(d=0;d<m.length;d++){if((j=m[d]).team===n){var w=qmath$1.dist(e.me.x,e.me.y,j.x,j.y),M=16,I=16;"defendSpot"===e.status&&(M=25,I=49),j.unit===SPECS.PREACHER&&w<=M?H.push([j.x,j.y]):j.unit===SPECS.CRUSADER&&w<=I&&H.push([j.x,j.y]);}else j.team===e.me.team&&(j.unit!==SPECS.PROPHET&&j.unit!==SPECS.CRUSADER&&j.unit!==SPECS.PREACHER||(q+=1));}if(q<4){var z=[];if(H.length>0){var O=search.circle(e,e.me.x,e.me.y,4);for(d=0;d<O.length;d++){var U=0,K=O[d];if(search.emptyPos(K[0],K[1],r,e.map)){for(u=0;u<H.length;u++)U+=qmath$1.dist(K[0],K[1],H[u][0],H[u][1]);z.push({pos:K,dist:U});}}}if(z.length>0){z.sort(function(e,t){return t.dist-e.dist});var V=base.rel(e.me.x,e.me.y,z[0].pos[0],z[0].pos[1]);return {action:e.move(V.dx,V.dy)}}}}if("defend"===e.status||"attackTarget"===e.status||"goToTarget"===e.status||"defendSpot"===e.status||"rally"===e.status||"defend2nd"===e.status){var F,G=99999999,N=!1;for(d=0;d<m.length;d++){var j;if((j=m[d]).team!==e.me.team){var B=qmath$1.dist(e.me.x,e.me.y,j.x,j.y);B<G&&B>=16&&(G=B,N=!0,F=j);}}if(G<=64&&!0===N){V=base.rel(e.me.x,e.me.y,F.x,F.y);if(e.readyAttack())return s=e.attack(V.dx,V.dy),{action:s}}if(!0===e.destroyedCastle){e.destroyedCastle=!1;e.knownStructures[e.me.team][0].x,e.knownStructures[e.me.team][0].y;e.status="defend";}}if("attackTarget"===e.status){if(!((w=qmath$1.dist(e.me.x,e.me.y,e.finalTarget[0],e.finalTarget[1]))>=82))return ""}else if("goToTarget"===e.status){(w=qmath$1.dist(e.me.x,e.me.y,e.finalTarget[0],e.finalTarget[1]))<=82&&e.signal(24585,100);}var J=!0;return "slow"!==e.moveSpeed&&"defend"!==e.status&&"defendOldPos"!==e.status&&"attackTarget"!==e.status&&"rally"!==e.status&&"defend2nd"!==e.status||(J=!1),e.me.turn<=3&&(J=!0),s=e.navigate(e.finalTarget,!1,J),{action:s}}function getIndexAllSpots$3(e,t){for(var a=0;a<e.allSpots.length;a++){var n=e.allSpots[a];if(n.x===t[0]&&n.y===t[1])return a}return null}var prophet = {mind: mind$4};

function attackNearestAOE(t){for(var r={},e=-100,a=!1,o=t.getVisibleRobotMap(),n=t.map,i=0;i<o.length;i++)for(var l=0;l<o[i].length;l++)if(o[i][l]>=0&&!0===n[i][l]){for(var f=search$1.circle(t,l,i,2),s=0,v=!1,c=0;c<f.length;c++){var m=f[c],u=o[m[1]][m[0]];if(u>0){t.getRobot(u).team!==t.me.team?(s+=1,v=!0):s-=1;}}e<s&&!0===v&&(r={x:l,y:i},e=s,a=!0);}return !0===a?r:null}function attackNearest(t){for(var r=99999999,e=null,a=!1,o=0;o<robotsInVision.length;o++){var n=robotsInVision[o];if(void 0!==n.x&&void 0!==n.y){var i=qmath.dist(t.me.x,t.me.y,n.x,n.y);i<r&&(r=i,{x:n.x,y:n.y},a=!0,e=n);}}return !0===a?e:null}var attack = {attackNearest, attackNearestAOE};

function mind$5(e){var t=e.map,a=e.map.length,s=(e.me.team+1)%2,n="",r=e.getFuelMap(),l=e.getKarboniteMap(),i=e.getVisibleRobotMap();if(5===e.me.turn&&(pathing.initializePlanner(e),e.setFinalTarget(e.finalTarget)),1===e.me.turn){e.useRallyTargetToMakeLattice=!0,e.defendLocChosen=!1,e.castleTalk(e.me.unit),e.allowedToMove=!0,e.finalTarget=[e.me.x,e.me.y],e.status="defend",e.oldStatus="defend",e.lastAttackedUnit=null,e.mapIsHorizontal=search.horizontalSymmetry(t);e.initializeCastleLocations()?(e.status="defend",e.oldStatus="defend",e.rallyTarget=[e.me.x,e.me.y],e.defendTarget=[e.me.x,e.me.y],e.finalTarget=[e.me.x,e.me.y]):(e.status="defend",e.oldStatus="defend",e.defendTarget=[e.me.x,e.me.y],e.finalTarget=[e.me.x,e.me.y]),e.enemyDirection=e.determineEnemyDirection(),e.origStructureLoc=null;for(var o=search.circle(e,e.me.x,e.me.y,2),d=0;d<o.length;d++){var u=o[d],f=i[u[1]][u[0]],g=e.getRobot(f);if(null!==g&&g.team===e.me.team&&(g.unit===SPECS.CASTLE||g.unit===SPECS.CHURCH)){e.origStructureLoc=u;break}}}var c=e.getVisibleRobots(),m={0:[],1:[],2:[],3:[],4:[],5:[],6:[]};for(d=0;d<c.length;d++){var T=c[d].signal;if(signal.processMessagePreacher(e,T),c[d].team===e.me.team&&c[d].id!==e.me.id)if(T>=12294&&T<=16389){"attackTarget"!==e.status&&(e.oldStatus=e.status),e.status="attackTarget";var y=12294,S=e.getLocation(T-y);e.finalTarget=[S.x,S.y];}else if(T>=16392&&T<=20487){"goToTarget"!==e.status&&(e.oldStatus=e.status),e.status="goToTarget";y=16392,S=e.getLocation(T-y);e.finalTarget=[S.x,S.y];}else if(T>=20488&&T<=24583){"goToTarget"!==e.status&&(e.oldStatus=e.status),e.status="goToTarget";y=20488,S=e.getLocation(T-y);e.finalTarget=[S.x,S.y],base.logStructure(e,e.finalTarget[0],e.finalTarget[1],s,0);}else if(T>=29003&&T<=33098&&"rally"!==e.status){"rally"!==e.status&&(e.oldStatus=e.status),e.status="rally";y=29003,S=e.getLocation(T-y);e.finalTarget=[S.x,S.y],e.rallyTarget=e.finalTarget;}else if(T>=41292&&T<=45387){"goToTarget"!==e.status&&(e.oldStatus=e.status),e.status="goToTarget";y=41292,S=e.getLocation(T-y);e.finalTarget=[S.x,S.y];}if(c[d].unit===SPECS.CHURCH&&m[6].push(c[d]),c[d].team===e.me.team&&T>=33099&&T<=37194){y=33099;var x=e.getLocation(T-y);base.logStructure(e,x.x,x.y,s,0);var L=x.x,h=x.y;e.mapIsHorizontal?h=a-h-1:L=a-L-1,base.logStructure(e,L,h,e.me.team,0),e.enemyDirection=e.determineEnemyDirection(L,h);}}base.updateKnownStructures(e),"rally"!==e.status&&(e.useRallyTargetToMakeLattice=!0);var k=search.findNearestStructure(e),v=qmath$1.dist(e.me.x,e.me.y,k.x,k.y);if(i[e.finalTarget[1]][e.finalTarget[0]]>0&&i[e.finalTarget[1]][e.finalTarget[0]]!==e.me.id&&(e.defendLocChosen=!1),("defend"===e.status||"defendOldPos"===e.status||"rally"===e.status)&&(e.me.x%2==1&&e.me.y%2==1||e.me.x%2==0&&e.me.y%2==0||!0===r[e.me.y][e.me.x]||!0===l[e.me.y][e.me.x]||v<=2||"defendOldPos"===e.status)){var D=null;!1===e.defendLocChosen&&("left"===e.enemyDirection?D="rally"===e.status?e.findDefendLoc(e,m,e.rallyTarget[0],a,0,a):e.findDefendLoc(e,m,0,e.defendTarget[0],0,a):"right"===e.enemyDirection?D="rally"===e.status?e.findDefendLoc(e,m,0,e.rallyTarget[0],0,a):e.findDefendLoc(e,m,e.defendTarget[0],a,0,a):"up"===e.enemyDirection?D="rally"===e.status?e.findDefendLoc(e,m,0,a,e.rallyTarget[1],a):e.findDefendLoc(e,m,0,a,0,e.defendTarget[1]):"down"===e.enemyDirection&&(D="rally"===e.status?e.findDefendLoc(e,m,0,a,0,e.rallyTarget[1]):e.findDefendLoc(e,m,0,a,e.defendTarget[1],a)),e.defendLocChosen=!0),null!==D&&(e.finalTarget=D),"defendOldPos"===e.status&&(e.status="defend");}if("searchAndAttack"===e.status&&(e.knownStructures[s].length?e.finalTarget=[e.knownStructures[s][0].x,e.knownStructures[s][0].y]:e.status="defend"),e.status,e.status,"defend"===e.status||"attackTarget"===e.status||"goToTarget"===e.status||"searchAndAttack"===e.status){var C=attack.attackNearestAOE(e);if(!0===e.destroyedCastle){e.destroyedCastle=!1;var p=[e.knownStructures[e.me.team][0].x,e.knownStructures[e.me.team][0].y];e.compressLocation(p[0],p[1]);e.status="defend";}if(null!==C){var b=base.rel(e.me.x,e.me.y,C.x,C.y);if(e.readyAttack())return n=e.attack(b.dx,b.dy),{action:n}}}if(e.status,e.status,!0===e.allowedToMove){var w=!1,A=!0;e.status,e.me.turn<=3&&"defend"===e.status&&(w=!1),"rally"===e.status&&(A=!1),n=e.navigate(e.finalTarget,w,A);}else n="";return {action:n}}var preacher = {mind: mind$5};

class MyRobot extends BCAbstractRobot {constructor(){super(),this.globalTurn=0,this.status="justBuilt",this.target=[0,0],this.finalTarget=[0,0],this.path=[],this.knownStructures={0:[],1:[]},this.knownDeposits={},this.castles=0,this.churches=0,this.pilgrims=0,this.crusaders=0,this.prophets=0,this.preachers=0,this.buildQueue=[],this.maxPilgrims=0,this.maxCrusaders=1e3,this.allSpots=[],this.fuelSpots=[],this.karboniteSpots=[],this.sentCommand=!1,this.planner=null,this.allUnits={};}turn(){if(this.me.unit===SPECS.CASTLE){return castle.mind(this).action}if(this.me.unit===SPECS.CRUSADER){return crusader.mind(this).action}if(this.me.unit===SPECS.PILGRIM){return pilgrim.mind(this).action}if(this.me.unit===SPECS.CHURCH){return church.mind(this).action}if(this.me.unit===SPECS.PROPHET){return prophet.mind(this).action}if(this.me.unit===SPECS.PREACHER){return preacher.mind(this).action}}canMove(t,e){var i=this.getVisibleRobotMap(),s=this.getPassableMap(),r=SPECS.UNITS[this.me.unit].FUEL_PER_MOVE;return r*=qmath$1.distDelta(t,e),!!(this.fuel>=r&&search.emptyPos(this.me.x+t,this.me.y+e,i,s))}readyAttack(){var t=SPECS.UNITS[this.me.unit].ATTACK_FUEL_COST;if(this.fuel>=t)return !0}setFinalTarget(t){this.finalTarget=t;var e=[];null!==this.planner?this.planner.search(this.me.y,this.me.x,t[1],t[0],e):e=[this.me.y,this.me.x,t[1],t[0]],e.shift(),e.shift(),this.path=e,this.target[1]=e.shift(),this.target[0]=e.shift();}navigate(t,e=false,i=true){if(null!==t){this.setFinalTarget(t);var s="";if(this.path.length>0){qmath$1.dist(this.me.x,this.me.y,this.target[0],this.target[1])<=2&&(this.target[1]=this.path.shift(),this.target[0]=this.path.shift());}if(this.target){var r=base.relToPos(this.me.x,this.me.y,this.target[0],this.target[1],this,e,i);0===r.dx&&0===r.dy?(s="",0===(r=base.relToPos(this.me.x,this.me.y,this.target[0],this.target[1],this,e,!0)).dx&&0===r.dy||(s=this.move(r.dx,r.dy))):s=this.move(r.dx,r.dy);}return s}return ""}getLocation(t){var e=t%this.map[0].length;return {x:e,y:(t-e)/this.map[0].length}}compressLocation(t,e){return t+e*this.map[0].length}initializeCastleLocations(){for(var t=search.circle(this,this.me.x,this.me.y,2),e=this.getVisibleRobotMap(),i=!1,s=null,r=0;r<t.length;r++){var n=t[r][0],a=t[r][1];if(null!==(s=this.getRobot(e[a][n]))&&s.unit===SPECS.CASTLE){this.knownStructures[this.me.team].push({x:s.x,y:s.y,unit:0}),i=!0;break}}if(!1===i)return this.knownStructures={0:[],1:[]},!1;var h=this.knownStructures[this.me.team][0].x,m=this.knownStructures[this.me.team][0].y,o=null;return null!==(o=this.mapIsHorizontal?[h,this.map.length-m-1]:[this.map[0].length-h-1,m])&&(this.knownStructures[(this.me.team+1)%2].push({x:o[0],y:o[1],unit:0}),s)}avoidEnemyLocations(t){var e=[],i=this.getVisibleRobotMap();if(t.length>0)for(var s=search.circle(this,this.me.x,this.me.y,4),r=0;r<s.length;r++){var n=0,a=s[r];if(search.emptyPos(a[0],a[1],i,this.map)){for(var h=0;h<t.length;h++)n+=qmath$1.dist(a[0],a[1],t[h][0],t[h][1]);e.push({pos:a,dist:n});}}if(e.length>0){e.sort(function(t,e){return e.dist-t.dist});return base.rel(this.me.x,this.me.y,e[0].pos[0],e[0].pos[1])}return null}findDefendLoc(t,e,i,s,r,n){var a=t.getVisibleRobotMap(),h=t.map,m=t.getFuelMap(),o=t.getKarboniteMap(),u=t.map.length,l=search.findNearestStructure(t),y=(qmath$1.dist(t.me.x,t.me.y,l.x,l.y),99999),c=null,d=0;"defendOldPos"!==t.status&&"defendSpot"!==t.status||(d=qmath$1.dist(t.me.x,t.me.y,t.defendTarget[0],t.defendTarget[1])),"rally"===t.status&&(d=qmath$1.dist(t.me.x,t.me.y,t.rallyTarget[0],t.rallyTarget[1]));for(var f=r;f<n;f++)for(var x=i;x<s;x++)if(f%2!=x%2&&(search.emptyPos(x,f,a,h,!1)||t.me.id===a[f][x])&&!1===m[f][x]&&!1===o[f][x]){var g=search.findNearestStructureHere(t,x,f,e[6]);if(qmath$1.dist(x,f,g.x,g.y)>2){var p=[t.me.x,t.me.y];"defendOldPos"===t.status||"defendSpot"===t.status?p=t.defendTarget:"rally"===t.status&&!0===t.useRallyTargetToMakeLattice&&(p=t.rallyTarget,d<=SPECS.UNITS[this.me.unit].VISION_RADIUS/4&&(t.useRallyTargetToMakeLattice=!1));(S=qmath$1.dist(p[0],p[1],x,f))<y&&(y=S,c=[x,f]);}}if(null===c)for(f=u;f<u;f++)for(x=0;x<u;x++)if(f%2!=x%2&&(search.emptyPos(x,f,a,h,!1)||t.me.id===a[f][x])&&!1===m[f][x]&&!1===o[f][x]){g=search.findNearestStructureHere(t,x,f,e[6]);if(qmath$1.dist(x,f,g.x,g.y)>2){var S;p=[t.me.x,t.me.y];(S=qmath$1.dist(p[0],p[1],x,f))<y&&(y=S,c=[x,f]);}}return c}determineEnemyDirection(t=this.me.x,e=this.me.y){var i=this.map.length;return this.mapIsHorizontal?e<=i/2?"down":"up":t<=i/2?"right":"left"}setBuildTowardsEnemyDirections(t){"left"===t.enemyDirection?t.buildingAttackUnitPositions=[[t.me.x-1,t.me.y-1],[t.me.x-1,t.me.y],[t.me.x-1,t.me.y+1],[t.me.x,t.me.y-1],[t.me.x,t.me.y+1],[t.me.x+1,t.me.y-1],[t.me.x+1,t.me.y],[t.me.x+1,t.me.y+1]]:"right"===t.enemyDirection?t.buildingAttackUnitPositions=[[t.me.x+1,t.me.y-1],[t.me.x+1,t.me.y],[t.me.x+1,t.me.y+1],[t.me.x,t.me.y-1],[t.me.x,t.me.y+1],[t.me.x-1,t.me.y-1],[t.me.x-1,t.me.y],[t.me.x-1,t.me.y+1]]:"down"===t.enemyDirection?t.buildingAttackUnitPositions=[[t.me.x-1,t.me.y+1],[t.me.x,t.me.y+1],[t.me.x+1,t.me.y+1],[t.me.x-1,t.me.y],[t.me.x+1,t.me.y],[t.me.x-1,t.me.y-1],[t.me.x,t.me.y-1],[t.me.x+1,t.me.y-1]]:"up"===t.enemyDirection&&(t.buildingAttackUnitPositions=[[t.me.x-1,t.me.y-1],[t.me.x,t.me.y-1],[t.me.x+1,t.me.y-1],[t.me.x-1,t.me.y],[t.me.x+1,t.me.y],[t.me.x-1,t.me.y+1],[t.me.x,t.me.y+1],[t.me.x+1,t.me.y+1]]);}}var robot=new MyRobot;robot.log(`New Bot: ${robot.id}`);
var robot = new MyRobot();
