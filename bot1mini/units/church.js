import {BCAbstractRobot, SPECS} from 'battlecode';import search from '../search.js';import base from '../base.js';import qmath from '../math.js';import signal from '../signals.js';import pathing from '../pathing/pathing-bundled.js';function mind(e){var t=e.map,r=e.map.length,u=(e.me.team+1)%2,a="",i=e.getFuelMap(),n=e.getKarboniteMap(),l=(e.getVisibleRobotMap(),e.getVisibleRobotMap()),s=e.map;if(1===e.me.turn){e.castleTalk(e.me.unit),e.buildQueue=[],e.builtDirect=!1,e.pastChurchChain=!1,e.churchAttackLoc=null,e.occupiedHalf=null,e.churchNeedsProtection=!1,e.mapIsHorizontal=search.horizontalSymmetry(t),e.mapIsHorizontal?(e.halfPoint=r/2,e.me.y<r/2?e.lowerHalf=!0:e.lowerHalf=!1):(e.halfPoint=r/2,e.me.x<r/2?e.lowerHalf=!0:e.lowerHalf=!1);for(var o=999999,c=0;c<r;c++)for(var h=0;h<r;h++)if(!0===i[c][h]&&(e.fuelSpots.push({x:h,y:c}),e.allSpots.push({x:h,y:c,type:"fuel"})),!0===n[c][h]){e.karboniteSpots.push({x:h,y:c}),e.allSpots.push({x:h,y:c,type:"karbonite"});var f=qmath.dist(h,c,e.me.x,e.me.y);f<o&&(o=f,[h,c])}var m=99999;for(c=0;c<e.fuelSpots.length;c++)if(!1===ownHalf(e,e.fuelSpots[c].x,e.fuelSpots[c].y)){(p=qmath.dist(e.fuelSpots[c].x,e.fuelSpots[c].y,e.me.x,e.me.y))<m&&(m=p)}for(c=0;c<e.karboniteSpots.length;c++)if(!1===ownHalf(e,e.karboniteSpots[c].x,e.karboniteSpots[c].y)){var p;(p=qmath.dist(e.karboniteSpots[c].x,e.karboniteSpots[c].y,e.me.x,e.me.y))<m&&(m=p)}m<=256&&(e.churchNeedsProtection=!0,e.buildQueue=[4]);e.fuelSpots.length;e.maxPilgrims=Math.ceil((e.fuelSpots.length+e.karboniteSpots.length)/2),e.enemyDirection=e.determineEnemyDirection(),e.buildingAttackUnitPositions=[],e.setBuildTowardsEnemyDirections(e)}var S=e.getVisibleRobots();for(c=0;c<S.length;c++){var d=S[c].signal;if(S[c].team===e.me.team)if(d>=33099&&d<=41290&&!1===e.pastChurchChain){var b=33099;d>=37195&&(b=37195);var g=e.getLocation(d-b);base.logStructure(e,g.x,g.y,u,0);var y=g.x,x=g.y;e.mapIsHorizontal?x=r-x-1:y=r-y-1,base.logStructure(e,y,x,e.me.team,0),e.enemyDirection=e.determineEnemyDirection(y,x);var v=!1;e.mapIsHorizontal?x<=r/2&&e.me.y>r/2?(v=!0,e.lowerHalf=!e.lowerHalf):x>=r/2&&e.me.y<r/2&&(v=!0,e.lowerHalf=!e.lowerHalf):y<=r/2&&e.me.x>r/2?(v=!0,e.lowerHalf=!e.lowerHalf):y>=r/2&&e.me.x<r/2&&(v=!0,e.lowerHalf=!e.lowerHalf),!0===v&&(e.churchNeedsProtection=v),37195===b&&(e.status="churchchain",e.churchNeedsProtection=!1,e.churchAttackLoc=[g.x,g.y])}else 41291===d&&"churchchain"===e.status&&(e.buildQueue=[5],e.signal(41291,4),e.status="spampreachers",e.pastChurchChain=!0)}var H=!1,P=null,k=1e3,C=null,E=!1,w=!1;for(c=0;c<S.length;c++){var R=S[c];if(R.team===u){R.unit===SPECS.CHURCH?E=!0:R.unit===SPECS.CRUSADER?w=!0:R.unit===SPECS.PROPHET&&!0;var T=qmath.dist(e.me.x,e.me.y,R.x,R.y);T<k&&(P={x:R.x,y:R.y},k=T,C=R.unit,H=!0)}}if("churchchain"===e.status){b=37195;if(e.karbonite<=500||e.fuel<=6100)b=33099,e.buildQueue=[5],e.signal(41291,4);else{if(null!==e.churchAttackLoc){d=e.compressLocation(e.churchAttackLoc[0],e.churchAttackLoc[1]);e.signal(b+d,4)}e.buildQueue=[2]}}else if("spampreachers"===e.status)if(e.karbonite<30||e.fuel<4e3)e.status="build",e.pastChurchChain=!1;else if(e.buildQueue=[5],null!==P){var L=e.compressLocation(P.x,P.y);b=41292;e.signal(b+L,64)}else e.buildQueue=[4];else e.status="build";if("churchchain"!==e.status&&"spampreachers"!==e.status)if(!1===H){search.unitsInRadius(e,8);var Q=search.unitsInRadius(e,100);if(!0===e.sawEnemyLastTurn&&(e.signal(16391,64),e.buildQueue=[]),e.karbonite>=125&&e.fuel>=60*(Q[SPECS.PROPHET].length+Q[SPECS.PREACHER].length)&&Q[SPECS.PROPHET].length<12&&!0===e.churchNeedsProtection&&(e.buildQueue=[4]),e.sawEnemyLastTurn=!1,e.karbonite>=50&&!1===e.builtDirect){var I=!1,A=null,N=search.circle(e,e.me.x,e.me.y,2);for(c=0;c<N.length;c++){var U=N[c][0],D=N[c][1],O=e.getRobot(l[D][U]);if((!0===i[D][U]||!0===n[D][U])&&null===O){I=!0,A=[U,D];break}}if(null===A&&(e.builtDirect=!0),!0===I&&enoughResourcesToBuild(e,2)){e.buildQueue=[];var M=getIndexAllSpots(e,A);e.turn>1&&e.castleTalk(77+M);var B=base.rel(e.me.x,e.me.y,A[0],A[1]);if(e.knownStructures[u].length){var z=e.knownStructures[u][0].x,q=e.knownStructures[u][0].y;d=e.compressLocation(z,q),b=33099;e.signal(b+d,2)}return a=e.buildUnit(2,B.dx,B.dy),{action:a}}}}else{var F=search.unitsInRadius(e,36);L=e.compressLocation(P.x,P.y),b=12294;C!==SPECS.PROPHET&&C!==SPECS.PILGRIM&&C!==SPECS.CHURCH||(b=20488),e.signal(b+L,64),e.sawEnemyLastTurn=!0,(E||w)&&F[SPECS.PREACHER].length<1&&e.fuel>=50&&e.karbonite>=30?e.buildQueue.unshift(5):e.buildQueue.unshift(4)}if("build"===e.status||"churchchain"===e.status||"spampreachers"===e.status)if(-1!==e.buildQueue[0]){var K=search.circle(e,e.me.x,e.me.y,2);if(e.buildQueue[0]>2&&"churchchain"!==e.status&&(K=e.buildingAttackUnitPositions),"churchchain"===e.status){var V=K.map(function(t){return{pos:t,dist:qmath.dist(t[0],t[1],e.churchAttackLoc[0],e.churchAttackLoc[1])}});V.sort(function(e,t){return e.dist-t.dist}),K=V.map(function(e){return e.pos})}for(c=0;c<K.length;c++){var _=K[c];if(canBuild(e,_[0],_[1],l,s)&&e.buildQueue.length>0&&enoughResourcesToBuild(e,e.buildQueue[0])){var G=e.buildQueue.shift();B=base.rel(e.me.x,e.me.y,_[0],_[1]);if(e.knownStructures[u].length){z=e.knownStructures[u][0].x,q=e.knownStructures[u][0].y,d=e.compressLocation(z,q),b=33099;"churchchain"!==e.status&&e.signal(b+d,2)}return a=e.buildUnit(G,B.dx,B.dy),{action:a}}}}else e.buildQueue.shift();return{action:a}}function getIndexAllSpots(e,t){for(var r=0;r<e.allSpots.length;r++){var u=e.allSpots[r];if(u.x===t[0]&&u.y===t[1])return r}return!1}function canBuild(e,t,r,u,a){return!(!search.inArr(t,r,u)||0!==u[r][t]||!0!==a[r][t])}function enoughResourcesToBuild(e,t){var r=SPECS.UNITS[t].CONSTRUCTION_FUEL,u=SPECS.UNITS[t].CONSTRUCTION_KARBONITE;return r<=e.fuel&&u<=e.karbonite}function numberOfDeposits(e,t,r){for(var u=search.circle(e,t,r,2),a=0,i=e.getFuelMap(),n=e.getKarboniteMap(),l=0;l<u.length;l++){var s=u[l][0],o=u[l][1];!0!==i[o][s]&&!0!==n[o][s]||(a+=1)}return a}function ownHalf(e,t,r){var u=e.map,a=u.length;if(e.mapIsHorizontal){if(e.lowerHalf){if(r<u.length/2)return!0}else if(r>=u.length/2)return!0}else if(e.lowerHalf){if(t<a/2)return!0}else if(t>=a/2)return!0;return!1}export default {mind};