import {BCAbstractRobot, SPECS} from 'battlecode';import search from '../search.js';import base from '../base.js';import qmath from '../math.js';import signal from '../signals.js';import pathing from '../pathing/pathing-bundled.js';import attack from '../attack.js';function mind(e){var t=e.map,a=e.map.length,s=(e.me.team+1)%2,n="",r=e.getFuelMap(),l=e.getKarboniteMap(),i=e.getVisibleRobotMap();if(5===e.me.turn&&(pathing.initializePlanner(e),e.setFinalTarget(e.finalTarget)),1===e.me.turn){e.useRallyTargetToMakeLattice=!0,e.defendLocChosen=!1,e.castleTalk(e.me.unit),e.allowedToMove=!0,e.finalTarget=[e.me.x,e.me.y],e.status="defend",e.oldStatus="defend",e.lastAttackedUnit=null,e.mapIsHorizontal=search.horizontalSymmetry(t);e.initializeCastleLocations()?(e.status="defend",e.oldStatus="defend",e.rallyTarget=[e.me.x,e.me.y],e.defendTarget=[e.me.x,e.me.y],e.finalTarget=[e.me.x,e.me.y]):(e.status="defend",e.oldStatus="defend",e.defendTarget=[e.me.x,e.me.y],e.finalTarget=[e.me.x,e.me.y]),e.enemyDirection=e.determineEnemyDirection(),e.origStructureLoc=null;for(var o=search.circle(e,e.me.x,e.me.y,2),d=0;d<o.length;d++){var u=o[d],f=i[u[1]][u[0]],g=e.getRobot(f);if(null!==g&&g.team===e.me.team&&(g.unit===SPECS.CASTLE||g.unit===SPECS.CHURCH)){e.origStructureLoc=u;break}}}var c=e.getVisibleRobots(),m={0:[],1:[],2:[],3:[],4:[],5:[],6:[]};for(d=0;d<c.length;d++){var T=c[d].signal;if(signal.processMessagePreacher(e,T),c[d].team===e.me.team&&c[d].id!==e.me.id)if(T>=12294&&T<=16389){"attackTarget"!==e.status&&(e.oldStatus=e.status),e.status="attackTarget";var y=12294,S=e.getLocation(T-y);e.finalTarget=[S.x,S.y]}else if(T>=16392&&T<=20487){"goToTarget"!==e.status&&(e.oldStatus=e.status),e.status="goToTarget";y=16392,S=e.getLocation(T-y);e.finalTarget=[S.x,S.y]}else if(T>=20488&&T<=24583){"goToTarget"!==e.status&&(e.oldStatus=e.status),e.status="goToTarget";y=20488,S=e.getLocation(T-y);e.finalTarget=[S.x,S.y],base.logStructure(e,e.finalTarget[0],e.finalTarget[1],s,0)}else if(T>=29003&&T<=33098&&"rally"!==e.status){"rally"!==e.status&&(e.oldStatus=e.status),e.status="rally";y=29003,S=e.getLocation(T-y);e.finalTarget=[S.x,S.y],e.rallyTarget=e.finalTarget}else if(T>=41292&&T<=45387){"goToTarget"!==e.status&&(e.oldStatus=e.status),e.status="goToTarget";y=41292,S=e.getLocation(T-y);e.finalTarget=[S.x,S.y]}if(c[d].unit===SPECS.CHURCH&&m[6].push(c[d]),c[d].team===e.me.team&&T>=33099&&T<=37194){y=33099;var x=e.getLocation(T-y);base.logStructure(e,x.x,x.y,s,0);var L=x.x,h=x.y;e.mapIsHorizontal?h=a-h-1:L=a-L-1,base.logStructure(e,L,h,e.me.team,0),e.enemyDirection=e.determineEnemyDirection(L,h)}}base.updateKnownStructures(e),"rally"!==e.status&&(e.useRallyTargetToMakeLattice=!0);var k=search.findNearestStructure(e),v=qmath.dist(e.me.x,e.me.y,k.x,k.y);if(i[e.finalTarget[1]][e.finalTarget[0]]>0&&i[e.finalTarget[1]][e.finalTarget[0]]!==e.me.id&&(e.defendLocChosen=!1),("defend"===e.status||"defendOldPos"===e.status||"rally"===e.status)&&(e.me.x%2==1&&e.me.y%2==1||e.me.x%2==0&&e.me.y%2==0||!0===r[e.me.y][e.me.x]||!0===l[e.me.y][e.me.x]||v<=2||"defendOldPos"===e.status)){var D=null;!1===e.defendLocChosen&&("left"===e.enemyDirection?D="rally"===e.status?e.findDefendLoc(e,m,e.rallyTarget[0],a,0,a):e.findDefendLoc(e,m,0,e.defendTarget[0],0,a):"right"===e.enemyDirection?D="rally"===e.status?e.findDefendLoc(e,m,0,e.rallyTarget[0],0,a):e.findDefendLoc(e,m,e.defendTarget[0],a,0,a):"up"===e.enemyDirection?D="rally"===e.status?e.findDefendLoc(e,m,0,a,e.rallyTarget[1],a):e.findDefendLoc(e,m,0,a,0,e.defendTarget[1]):"down"===e.enemyDirection&&(D="rally"===e.status?e.findDefendLoc(e,m,0,a,0,e.rallyTarget[1]):e.findDefendLoc(e,m,0,a,e.defendTarget[1],a)),e.defendLocChosen=!0),null!==D&&(e.finalTarget=D),"defendOldPos"===e.status&&(e.status="defend")}if("searchAndAttack"===e.status&&(e.knownStructures[s].length?e.finalTarget=[e.knownStructures[s][0].x,e.knownStructures[s][0].y]:e.status="defend"),e.status,e.status,"defend"===e.status||"attackTarget"===e.status||"goToTarget"===e.status||"searchAndAttack"===e.status){var C=attack.attackNearestAOE(e);if(!0===e.destroyedCastle){e.destroyedCastle=!1;var p=[e.knownStructures[e.me.team][0].x,e.knownStructures[e.me.team][0].y];e.compressLocation(p[0],p[1]);e.status="defend"}if(null!==C){var b=base.rel(e.me.x,e.me.y,C.x,C.y);if(e.readyAttack())return n=e.attack(b.dx,b.dy),{action:n}}}if(e.status,e.status,!0===e.allowedToMove){var w=!1,A=!0;e.status,e.me.turn<=3&&"defend"===e.status&&(w=!1),"rally"===e.status&&(A=!1),n=e.navigate(e.finalTarget,w,A)}else n="";return{action:n}}export default {mind};